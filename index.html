<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëŠ˜ë´„ ê±´ê°• í€´ì¦ˆ</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
  <script>
    Kakao.init('2c0e3c8b8e6b4c8f9d5a7e1f3b9c6d2e'); // ëŠ˜ë´„ ì•± ì¹´ì¹´ì˜¤ JavaScript í‚¤
    // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í™•ì¸ìš© ì½”ë“œ
    console.log('ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨');
    // ì•± ì„¤ì¹˜ ë°°ë„ˆ ë‹«ê¸° í•¨ìˆ˜ ì¶”ê°€
    function closeInstallBanner() {
      var banner = document.getElementById('install-banner');
      if (banner) banner.style.display = 'none';
    }
  </script>
  <style>
    .link-copy-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      max-width: 320px;
      height: 60px;
      margin: 24px auto 0 auto;
      background-color: #e0ede3;
      border-radius: 999px;
      color: #356c55;
      font-size: 16px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s ease, box-shadow 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .link-copy-btn:hover {
      background-color: #d0e5d6;
      box-shadow: 0 4px 12px rgba(53,108,85,0.08);
    }
    .link-copy-btn img {
      width: 22px;
      height: 22px;
      vertical-align: middle;
    }
    @media (max-width: 480px) {
      .link-copy-btn {
        max-width: 95vw;
        height: 48px;
        font-size: 15px;
      }
      .link-copy-btn img {
        width: 18px;
        height: 18px;
      }
    }
    #copy-msg {
      display:none;
      color:#2e7d32;
      font-weight:bold;
      font-size:1.1em;
      margin-top:10px;
    }
    .social-share-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 16px;
    }
    
    .social-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .social-btn:hover {
      opacity: 0.9;
    }
    
    .social-btn img {
      width: 20px;
      height: 20px;
    }
    
    .kakao-btn {
      background-color: #FEE500;
      color: #000000;
    }
    
    .facebook-btn {
      background-color: #1877F2;
      color: #FFFFFF;
    }

    .share-section {
      background: rgba(255, 255, 255, 0.9);
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin: 24px auto;
      max-width: 600px;
    }

    .share-title {
      color: #356c55;
      font-size: 18px;
      margin-bottom: 16px;
      font-weight: 600;
    }

    .social-share-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .social-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      border-radius: 12px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .social-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .social-btn img {
      width: 24px;
      height: 24px;
    }
    
    .kakao-btn {
      background-color: #FEE500;
      color: #000000;
    }
    
    .facebook-btn {
      background-color: #1877F2;
      color: #FFFFFF;
    }

    .instagram-btn {
      background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
      color: #FFFFFF;
    }

    .line-btn {
      background-color: #06C755;
      color: #FFFFFF;
    }

    .share-reward {
      color: #356c55;
      font-size: 14px;
      margin-top: 12px;
      font-weight: 500;
    }

    @media (max-width: 480px) {
      .social-share-buttons {
        grid-template-columns: 1fr;
      }
      
      .share-section {
        margin: 16px;
        padding: 16px;
      }
    }

    .install-btn {
      background-color: #356c55;
      color: #fff;
    }

    /* ì¹´ë“œí˜• í”¼ë“œ UI ìŠ¤íƒ€ì¼ */
    .feed-card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 2px 10px rgba(53,108,85,0.06);
      margin-bottom: 20px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .feed-card:hover {
      box-shadow: 0 4px 20px rgba(53,108,85,0.12);
      transform: translateY(-2px);
    }

    .feed-card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 0;
    }

    .feed-card-content {
      padding: 20px;
    }

    .feed-card-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c2c2c;
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .feed-card-preview {
      font-size: 15px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .feed-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: #888;
      margin-bottom: 16px;
    }

    .feed-card-author {
      display: flex;
      align-items: center;
    }

    .feed-card-avatar {
      width: 24px;
      height: 24px;
      background: #e0ede3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #356c55;
      font-weight: 600;
    }

    .feed-card-stats {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .feed-card-stat {
      display: flex;
      align-items: center;
      gap: 4px;
      color: #666;
    }

    .feed-card-comments {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      display: none;
    }

    .feed-card-comments.active {
      display: block;
    }

    .feed-comment {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #eee;
    }

    .feed-comment:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .feed-comment-avatar {
      width: 28px;
      height: 28px;
      background: #e0ede3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #356c55;
      font-weight: 600;
      flex-shrink: 0;
    }

    .feed-comment-content {
      flex: 1;
    }

    .feed-comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .feed-comment-author {
      font-size: 13px;
      font-weight: 600;
      color: #356c55;
    }

    .feed-comment-time {
      font-size: 12px;
      color: #999;
    }

    .feed-comment-text {
      font-size: 14px;
      color: #333;
      line-height: 1.5;
    }

    .feed-comment-input-section {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      padding: 16px;
      background: #fafbfc;
      border-radius: 16px;
      border: 1px solid #e8ebed;
      transition: all 0.2s ease;
    }

    .feed-comment-input-section:focus-within {
      border-color: #356c55;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(53,108,85,0.08);
    }

    .feed-comment-input {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: 24px;
      font-size: 15px;
      background: #ffffff;
      outline: none;
      transition: all 0.2s ease;
      color: #333;
      line-height: 1.4;
      min-height: 20px;
      resize: none;
    }

    .feed-comment-input::placeholder {
      color: #9ca3af;
      font-weight: 400;
    }

    .feed-comment-input:focus {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(53,108,85,0.05);
    }

    .feed-comment-submit {
      padding: 12px 20px;
      background: #356c55;
      color: white;
      border: none;
      border-radius: 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      min-width: 70px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .feed-comment-submit:hover:not(:disabled) {
      background: #2a5544;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(53,108,85,0.2);
    }

    .feed-comment-submit:disabled {
      background: #d1d5db;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .feed-comment-submit:active:not(:disabled) {
      transform: translateY(0);
    }

    /* ëŒ“ê¸€ ì…ë ¥ ê¸€ì ìˆ˜ í‘œì‹œ */
    .comment-char-count {
      position: absolute;
      bottom: -20px;
      right: 16px;
      font-size: 12px;
      color: #9ca3af;
      transition: color 0.2s ease;
    }

    .comment-char-count.warning {
      color: #f59e0b;
    }

    .comment-char-count.error {
      color: #ef4444;
    }

    /* ëŒ“ê¸€ ì…ë ¥ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ */
    .comment-input-container {
      position: relative;
      margin-bottom: 24px;
    }

    /* í† ìŠ¤íŠ¸ ì•Œë¦¼ ê³ ë„í™” */
    .salon-toast {
      position: fixed !important;
      bottom: 24px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
      color: white !important;
      padding: 16px 24px !important;
      border-radius: 28px !important;
      font-size: 15px !important;
      font-weight: 600 !important;
      z-index: 10001 !important;
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3), 
                  0 4px 16px rgba(0, 0, 0, 0.1) !important;
      backdrop-filter: blur(8px) !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      max-width: 90vw !important;
      min-width: 280px !important;
      text-align: center !important;
    }

    .salon-toast.error {
      background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%) !important;
      box-shadow: 0 8px 32px rgba(244, 67, 54, 0.3), 
                  0 4px 16px rgba(0, 0, 0, 0.1) !important;
    }

    .salon-toast.warning {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important;
      box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3), 
                  0 4px 16px rgba(0, 0, 0, 0.1) !important;
    }

    .salon-toast-content {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 12px !important;
    }

    .salon-toast-icon {
      font-size: 18px !important;
      display: inline-block !important;
      animation: toastIconBounce 0.6s ease !important;
    }

    .salon-toast-message {
      font-weight: 600 !important;
      letter-spacing: -0.02em !important;
    }

    /* í† ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes toastSlideUp {
      0% {
        transform: translateX(-50%) translateY(120%);
        opacity: 0;
        scale: 0.9;
      }
      100% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        scale: 1;
      }
    }

    @keyframes toastSlideDown {
      0% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
        scale: 1;
      }
      100% {
        transform: translateX(-50%) translateY(120%);
        opacity: 0;
        scale: 0.9;
      }
    }

    @keyframes toastIconBounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-4px);
      }
      60% {
        transform: translateY(-2px);
      }
    }

    /* ëŒ“ê¸€ ì„¹ì…˜ í—¤ë” */
    .comments-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding: 0 4px;
    }

    .comments-count {
      font-size: 14px;
      font-weight: 600;
      color: #6b7280;
    }

    .comments-sort {
      font-size: 12px;
      color: #9ca3af;
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background 0.2s ease;
    }

    .comments-sort:hover {
      background: #f3f4f6;
    }

    /* ëŒ“ê¸€ ì…ë ¥ ìƒíƒœ í‘œì‹œ */
    .comment-input-status {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      padding: 0 16px;
    }

    .input-status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #d1d5db;
      transition: background 0.2s ease;
    }

    .input-status-dot.active {
      background: #356c55;
      animation: statusPulse 2s infinite;
    }

    .input-status-text {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    @keyframes statusPulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      .feed-comment-input-section {
        margin: 12px 8px 0;
        padding: 12px;
        gap: 8px;
      }

      .feed-comment-input {
        padding: 10px 14px;
        font-size: 14px;
      }

      .feed-comment-submit {
        padding: 10px 16px;
        font-size: 14px;
        min-width: 60px;
        height: 40px;
      }

      .salon-toast {
        bottom: 20px !important;
        margin: 0 16px !important;
        min-width: auto !important;
        max-width: calc(100vw - 32px) !important;
        padding: 14px 20px !important;
        font-size: 14px !important;
      }

      .comment-char-count {
        bottom: -18px;
        right: 12px;
        font-size: 11px;
      }
    }

    /* ëŒ“ê¸€ ì¹´ìš´íŠ¸ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì• ë‹ˆë©”ì´ì…˜ */
    .comment-count-update {
      animation: countUpdate 0.3s ease;
    }

    @keyframes countUpdate {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
        color: #356c55;
      }
      100% {
        transform: scale(1);
      }
    }

    /* ëŒ“ê¸€ ë“±ë¡ ì„±ê³µ ì‹œ ì…ë ¥ì°½ ì• ë‹ˆë©”ì´ì…˜ */
    .comment-input-success {
      animation: inputSuccess 0.5s ease;
    }

    @keyframes inputSuccess {
      0% {
        background: #fafbfc;
      }
      50% {
        background: rgba(76, 175, 80, 0.1);
        border-color: #4CAF50;
      }
      100% {
        background: #fafbfc;
      }
    }

    /* ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ì¹´ë“œ ìŠ¬ë¼ì´ë“œ UI */
    .card-slider-container {
      position: relative;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
      overflow: hidden;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(53,108,85,0.15);
    }

    .card-slider {
      display: flex;
      transition: transform 0.3s ease;
      width: 100%;
    }

    .story-card {
      min-width: 100%;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
    }

    .story-card-image {
      width: 100%;
      height: 300px;
      object-fit: cover;
      background: linear-gradient(135deg, #e0ede3 0%, #f8f9fa 100%);
    }

    .story-card-content {
      padding: 24px;
    }

    .story-card-title {
      font-size: 20px;
      font-weight: 700;
      color: #2c2c2c;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .story-card-text {
      font-size: 16px;
      color: #555;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .story-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    .story-card-author {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .story-card-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #356c55 0%, #4a7c59 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
      font-weight: 700;
    }

    .story-card-author-info {
      display: flex;
      flex-direction: column;
    }

    .story-card-author-name {
      font-size: 15px;
      font-weight: 600;
      color: #356c55;
    }

    .story-card-time {
      font-size: 13px;
      color: #999;
    }

    .story-card-actions {
      display: flex;
      gap: 16px;
    }

    .story-action-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 20px;
      transition: all 0.2s ease;
      font-size: 14px;
      font-weight: 600;
    }

    .story-action-btn:hover {
      background: rgba(53,108,85,0.1);
    }

    .story-action-btn.liked {
      color: #e74c3c;
    }

    .story-action-btn.comment-btn {
      color: #356c55;
    }

    /* ì¹´ë“œ ë„¤ë¹„ê²Œì´ì…˜ */
    .card-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.9);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #356c55;
      transition: all 0.2s ease;
      z-index: 10;
    }

    .card-nav:hover {
      background: rgba(255,255,255,1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .card-nav.prev {
      left: 16px;
    }

    .card-nav.next {
      right: 16px;
    }

    .card-nav:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    /* ì¹´ë“œ ì¸ë””ì¼€ì´í„° */
    .card-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 16px;
    }

    .card-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ddd;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .card-indicator.active {
      background: #356c55;
      transform: scale(1.2);
    }

    /* ëŒ“ê¸€ ì˜ì—­ (ì¹´ë“œ í•˜ë‹¨) */
    .story-comments-section {
      background: #fafbfc;
      border-top: 1px solid #f0f0f0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .story-comments-section.active {
      max-height: 400px;
    }

    .story-comments-header {
      padding: 16px 24px 0;
      font-size: 14px;
      font-weight: 600;
      color: #666;
    }

    .story-comments-list {
      padding: 16px 24px;
      max-height: 200px;
      overflow-y: auto;
    }

    .story-comment {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .story-comment:last-child {
      margin-bottom: 0;
    }

    .story-comment-avatar {
      width: 32px;
      height: 32px;
      background: #e0ede3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #356c55;
      font-weight: 600;
      flex-shrink: 0;
    }

    .story-comment-content {
      flex: 1;
    }

    .story-comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .story-comment-author {
      font-size: 13px;
      font-weight: 600;
      color: #356c55;
    }

    .story-comment-time {
      font-size: 12px;
      color: #999;
    }

    .story-comment-text {
      font-size: 14px;
      color: #333;
      line-height: 1.5;
    }

    .story-comment-input {
      padding: 16px 24px;
      border-top: 1px solid #f0f0f0;
    }

    .story-comment-form {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .story-comment-textarea {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 20px;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: border-color 0.2s ease;
      min-height: 40px;
      max-height: 80px;
    }

    .story-comment-textarea:focus {
      border-color: #356c55;
    }

    .story-comment-submit {
      padding: 12px 20px;
      background: #356c55;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .story-comment-submit:hover:not(:disabled) {
      background: #2a5544;
    }

    .story-comment-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* ì§ˆë¬¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .question-card {
      background: linear-gradient(135deg, #356c55 0%, #4a7c59 100%);
      color: white;
    }

    .question-card .story-card-title {
      color: white;
      font-size: 22px;
    }

    .question-card .story-card-text {
      color: rgba(255,255,255,0.9);
    }

    .question-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .question-option {
      padding: 16px 20px;
      background: rgba(255,255,255,0.1);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 15px;
      font-weight: 500;
    }

    .question-option:hover {
      background: rgba(255,255,255,0.2);
      border-color: rgba(255,255,255,0.4);
    }

    .question-option:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .question-reward {
      text-align: center;
      margin-top: 16px;
      font-size: 14px;
      color: rgba(255,255,255,0.8);
    }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      .card-slider-container {
        max-width: 95vw;
        margin: 0 auto;
      }

      .story-card-content {
        padding: 20px;
      }

      .story-card-title {
        font-size: 18px;
      }

      .story-card-text {
        font-size: 15px;
      }

      .card-nav {
        width: 36px;
        height: 36px;
        font-size: 16px;
      }

      .card-nav.prev {
        left: 12px;
      }

      .card-nav.next {
        right: 12px;
      }
    }

    /* ì „ì²´ í™”ë©´ í˜ì´ì§€ ì „í™˜ ìŠ¤íƒ€ì¼ */
    .fullscreen-page {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      z-index: 1000;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .fullscreen-page.active {
      transform: translateX(0);
    }

    .fullscreen-page-header {
      position: sticky;
      top: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 16px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }

    .fullscreen-back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: #356c55;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .fullscreen-back-btn:hover {
      background: #2a5544;
      transform: translateY(-1px);
    }

    .fullscreen-page-title {
      font-size: 20px;
      font-weight: 700;
      color: #356c55;
      margin: 0;
    }

    .fullscreen-page-content {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      min-height: calc(100vh - 80px);
    }

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width: 768px) {
      .fullscreen-page-header {
        padding: 12px 16px;
      }

      .fullscreen-back-btn {
        padding: 10px 14px;
        font-size: 15px;
      }

      .fullscreen-page-title {
        font-size: 18px;
      }

      .fullscreen-page-content {
        padding: 16px;
      }

      .card-slider-container {
        margin: 0 -8px;
      }
    }

    /* í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
    .page-transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: rgba(53, 108, 85, 0.8);
      z-index: 999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .page-transition-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* 1. í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼ CSS ì¶”ê°€ (body í•˜ë‹¨ ê³ ì •) */
    .floating-write-btn {
      position: fixed;
      right: 24px;
      bottom: 32px;
      z-index: 1002;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: #fff;
      font-size: 32px;
      box-shadow: 0 4px 16px rgba(53,108,85,0.18);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
    }
    .floating-write-btn:hover {
      background: linear-gradient(135deg, #45a049 0%, #388e3c 100%);
      box-shadow: 0 8px 32px rgba(53,108,85,0.22);
      transform: scale(1.07);
    }
    @media (max-width: 600px) {
      .floating-write-btn {
        right: 16px;
        bottom: 16px;
        width: 52px;
        height: 52px;
        font-size: 28px;
      }
    }

    /* ê¸€ì“°ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #free-write-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    #free-write-fullscreen.active {
      display: flex;
      opacity: 1;
      visibility: visible;
    }

    .write-modal-card {
      width: 90%;
      max-width: 600px;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(53,108,85,0.15);
      padding: 28px;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    #free-write-fullscreen.active .write-modal-card {
      transform: translateY(0);
    }

    .write-modal-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .writer-avatar {
      width: 36px;
      height: 36px;
      background: #e0ede3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .writer-info {
      flex: 1;
    }

    .writer-label {
      font-size: 15px;
      font-weight: 600;
      color: #356c55;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .point-badge {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
    }

    .write-modal-title {
      color: #356c55;
      font-size: 18px;
      font-weight: 600;
      margin: 16px 0;
    }

    .write-textarea-container {
      position: relative;
      margin: 20px 0;
    }

    #habit-salon-free-content {
      width: 100%;
      min-height: 180px;
      padding: 16px;
      border: 2px solid #e0ede3;
      border-radius: 16px;
      font-size: 15px;
      line-height: 1.6;
      resize: none;
      transition: all 0.2s ease;
    }

    #habit-salon-free-content:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 4px rgba(76,175,80,0.1);
    }

    #habit-salon-free-content::placeholder {
      color: #999;
    }

    .char-counter {
      position: absolute;
      right: 16px;
      bottom: 16px;
      font-size: 13px;
      color: #666;
    }

    .write-modal-footer {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      justify-content: space-between;
      align-items: center;
    }

    .write-modal-footer .point-info {
      font-size: 14px;
      color: #666;
    }

    .write-modal-actions {
      display: flex;
      gap: 12px;
    }

    .write-submit-btn {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .write-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76,175,80,0.2);
    }

    .write-submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .write-cancel-btn {
      background: #f5f5f5;
      color: #666;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .write-cancel-btn:hover {
      background: #eee;
    }

    /* í”Œë¡œíŒ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .floating-write-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(76,175,80,0.3);
      transition: all 0.2s ease;
      z-index: 1000;
    }

    .floating-write-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(76,175,80,0.4);
    }

    .floating-write-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(76,175,80,0.3);
    }

    @media (max-width: 480px) {
      .floating-write-btn {
        bottom: 16px;
        right: 16px;
      }
    }

    /* ëª¨ë‹¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      width: 90%;
      max-width: 600px;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(53,108,85,0.15);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e0ede3;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 1.25rem;
      color: #356c55;
      margin: 0;
    }

    .modal-close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #666;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .modal-close-btn:hover {
      background-color: #f5f5f5;
    }

    .modal-body {
      padding: 24px;
    }

    #habit-salon-free-content {
      width: 100%;
      min-height: 180px;
      padding: 16px;
      border: 2px solid #e0ede3;
      border-radius: 16px;
      font-size: 15px;
      line-height: 1.6;
      resize: none;
      margin-bottom: 16px;
      transition: all 0.2s ease;
    }

    #habit-salon-free-content:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 4px rgba(76,175,80,0.1);
    }

    .modal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .point-info {
      font-size: 14px;
      color: #666;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
    }

    .cancel-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #f5f5f5;
      color: #666;
    }

    .submit-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .submit-btn .point-badge {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 13px;
    }

    @media (max-width: 600px) {
      .modal-content {
        width: 95%;
        margin: 10px;
      }
    }

    /* ëŒ“ê¸€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .story-comments-section {
      margin-top: 16px;
      border-top: 1px solid #e0ede3;
      padding-top: 16px;
    }

    .story-comments-header {
      margin-bottom: 16px;
    }

    .story-comments-header h3 {
      font-size: 16px;
      color: #356c55;
      margin: 0;
    }

    .story-comment-form {
      margin-bottom: 20px;
    }

    .story-comment-form textarea {
      width: 100%;
      min-height: 80px;
      padding: 12px;
      border: 1px solid #e0ede3;
      border-radius: 12px;
      font-size: 14px;
      resize: none;
      margin-bottom: 8px;
    }

    .story-comment-form textarea:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 2px rgba(76,175,80,0.1);
    }

    .story-comment-submit {
      padding: 8px 20px;
      background: #356c55;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .story-comment-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .story-comments-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .story-comment {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 16px;
    }

    .story-comment-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 8px;
    }

    .story-comment-author {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .story-comment-avatar {
      width: 32px;
      height: 32px;
      background: #e0ede3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #356c55;
    }

    .story-comment-info {
      display: flex;
      flex-direction: column;
    }

    .story-comment-name {
      font-size: 14px;
      font-weight: 600;
      color: #356c55;
    }

    .story-comment-time {
      font-size: 12px;
      color: #666;
    }

    .story-comment-text {
      font-size: 14px;
      line-height: 1.5;
      color: #333;
    }

    .comment-count-update {
      animation: countUpdate 0.3s ease;
    }

    @keyframes countUpdate {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    /* ëŒ“ê¸€ ì„¹ì…˜ ê¸°ë³¸ ìƒíƒœ */
    .story-comments-section {
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    /* ëŒ“ê¸€ ì„¹ì…˜ í™œì„±í™” ìƒíƒœ */
    .story-comments-section.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* ê¸€ì“°ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .write-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 9999;
      display: none;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .write-modal.active {
      display: flex;
      opacity: 1;
      visibility: visible;
    }

    .write-modal-content {
      width: 90%;
      max-width: 600px;
      margin: auto;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 8px 32px rgba(53,108,85,0.15);
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .write-modal.active .write-modal-content {
      transform: translateY(0);
    }

    .write-modal-header {
      padding: 24px;
      border-bottom: 1px solid #e0ede3;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .write-modal-header h2 {
      font-size: 1.25rem;
      color: #356c55;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .write-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: #666;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }

    .write-modal-close:hover {
      background: #f5f5f5;
    }

    .write-modal-body {
      padding: 24px;
    }

    .write-form textarea {
      width: 100%;
      min-height: 180px;
      padding: 16px;
      border: 2px solid #e0ede3;
      border-radius: 16px;
      font-size: 15px;
      line-height: 1.6;
      resize: none;
      transition: all 0.2s ease;
    }

    .write-form textarea:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 4px rgba(76,175,80,0.1);
    }

    .write-form textarea::placeholder {
      color: #999;
    }

    .char-counter {
      text-align: right;
      font-size: 13px;
      color: #666;
      margin-top: 8px;
    }

    .write-modal-footer {
      padding: 0 24px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .point-info {
      color: #666;
      font-size: 14px;
    }

    .write-modal-actions {
      display: flex;
      gap: 12px;
    }

    .write-cancel-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      background: #f5f5f5;
      color: #666;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .write-cancel-btn:hover {
      background: #e0e0e0;
    }

    .write-submit-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      background: #4CAF50;
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    .write-submit-btn:hover {
      background: #45a049;
    }

    .write-submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .write-submit-btn .point-badge {
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 13px;
    }

    /* í”Œë¡œíŒ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .floating-write-btn {
      position: fixed;
      right: 24px;
      bottom: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #4CAF50;
      color: #fff;
      font-size: 24px;
      border: none;
      box-shadow: 0 4px 16px rgba(76,175,80,0.2);
      cursor: pointer;
      transition: all 0.2s;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .floating-write-btn:hover {
      background: #45a049;
      transform: scale(1.05);
      box-shadow: 0 6px 24px rgba(76,175,80,0.3);
    }

    @media (max-width: 768px) {
      .floating-write-btn {
        right: 16px;
        bottom: 16px;
        width: 48px;
        height: 48px;
        font-size: 20px;
      }
    }

    .write-guide {
      background: #f5f9f6;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .write-guide p {
      color: #2E7D32;
      font-weight: 600;
      margin: 0 0 8px 0;
    }

    .write-guide ul {
      color: #4CAF50;
      margin: 0;
      padding-left: 20px;
    }

    .write-guide li {
      margin: 4px 0;
      font-size: 14px;
    }

    .char-count-guide {
      text-align: center;
      margin: 8px 0;
      font-size: 14px;
      transition: color 0.2s;
    }

    #habit-salon-free-content {
      min-height: 200px;
    }

    /* ë¸Œëœë“œ ì´ì•¼ê¸° ì„¹ì…˜ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .brand-story-image {
      width: 100%;
      max-width: 600px;
      height: auto;
      object-fit: contain;
      margin: 0 auto;
      display: block;
    }

    .comments-section {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
    }

    .comment-input {
      width: 100%;
      max-width: 100%;
      margin: 10px 0;
    }

    @media (max-width: 480px) {
      .brand-story-image {
        max-width: 100%;
        padding: 0 15px;
      }
      
      .comments-section {
        padding: 0 10px;
      }
    }

    /* ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .brand-story-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .brand-story-image {
      width: 100%;
      max-width: 600px;
      height: auto;
      object-fit: contain;
      margin: 0 auto;
      display: block;
      border-radius: 12px;
    }

    .comments-section {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
    }

    .comment-input {
      width: 100%;
      max-width: 100%;
      margin: 10px 0;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
    }

    .comment-list {
      max-width: 600px;
      margin: 0 auto;
    }

    @media (max-width: 480px) {
      .brand-story-container {
        padding: 10px;
      }

      .brand-story-image {
        max-width: 100%;
        border-radius: 8px;
      }
      
      .comments-section {
        padding: 0 10px;
      }
    }

    /* ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .brand-story-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(53,108,85,0.06);
    }

    .brand-story-image {
      width: 100%;
      max-width: 100%;
      height: auto;
      object-fit: contain;
      margin: 0 auto;
      display: block;
      border-radius: 12px;
    }

    .comments-section {
      max-width: 100%;
      margin: 20px auto;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .comment-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .comment-list {
      margin-top: 20px;
    }

    @media (max-width: 480px) {
      .brand-story-container {
        padding: 15px;
        margin: 10px;
      }
      
      .comments-section {
        padding: 10px;
        margin: 15px auto;
      }
    }

    /* ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .brand-story-container {
      max-width: 100%;
      margin: 0 auto;
      padding: 0;
      background: #fff;
    }

    .brand-story-image {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
      margin: 0 auto;
    }

    .brand-story-comments {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 15px;
    }

    .comment-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      margin: 10px 0;
      font-size: 14px;
    }

    .comment-list {
      margin-top: 20px;
    }

    @media (max-width: 480px) {
      .brand-story-container {
        margin: 0;
      }
      
      .brand-story-comments {
        padding: 0 10px;
      }
    }

    /* ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .story-card {
      background: #fff;
      border-radius: 0;
      overflow: hidden;
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .story-card-image {
      width: 100%;
      height: auto;
      max-height: none;
      object-fit: contain;
      margin: 0;
      display: block;
    }

    .story-card-content {
      padding: 20px;
      flex: 1;
    }

    .story-comments-section {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .story-comment-textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      margin: 10px 0;
      font-size: 14px;
    }

    .story-comment-submit {
      background-color: #356c55;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 8px;
    }

    @media (max-width: 480px) {
      .story-card-content {
        padding: 15px;
      }
      
      .story-comments-section {
        margin: 10px;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  </style>
</head>
<body>
  </style>
</head>
<body>
  </style>
</head>
<body>
  <div id="install-banner" style="display:block; position:fixed; bottom:0; left:0; width:100%; background:#ffffff; padding:16px; text-align:center; z-index:9999; box-shadow:0 -2px 10px rgba(0,0,0,0.2); border-top:1px solid #eee;">
    <div style="max-width:460px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div style="flex:1; text-align:left;">
        <p style="margin:0; font-size:16px; font-weight:600; color:#356c55;">ğŸ“± ì•± ì„¤ì¹˜í•˜ê³  ë” í¸ë¦¬í•˜ê²Œ ì´ìš©í•´ë³´ì„¸ìš”!</p>
        <p style="margin:4px 0 0; font-size:14px; color:#666;">ì„¤ì¹˜í•˜ë©´ í™ˆ í™”ë©´ì—ì„œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ìš”</p>
      </div>
      <div style="display:flex; gap:8px;">
        <button onclick="closeInstallBanner()" style="padding:8px 16px; border:none; background:#f0f0f0; border-radius:6px; color:#666; font-size:14px; cursor:pointer; font-weight:500;">ë‹«ê¸°</button>
        <a href="https://play.google.com/store/apps/details?id=com.neulbom.neulbomquiz" target="_blank" style="padding:8px 20px; border:none; background:#356c55; border-radius:6px; color:#fff; font-size:14px; text-decoration:none; font-weight:500;">ì„¤ì¹˜í•˜ê¸°</a>
      </div>
    </div>
  </div>

  <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
  <div id="free-write-fullscreen" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âœï¸ ê±´ê°• ì´ì•¼ê¸° ì“°ê¸°</h2>
        <button class="modal-close-btn" onclick="window.closeWriteModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="habit-salon-free-form">
          <div class="write-guide">
            <p>ğŸ’¡ ë‚˜ë§Œì˜ ê±´ê°• ê²½í—˜ê³¼ ë…¸í•˜ìš°ë¥¼ ìì„¸íˆ ê³µìœ í•´ì£¼ì„¸ìš”!</p>
            <ul>
              <li>ì‹¤ì œ ê²½í—˜í•œ ê±´ê°• ê´€ë¦¬ ë°©ë²•</li>
              <li>íš¨ê³¼ë¥¼ ë³¸ ìš´ë™ì´ë‚˜ ì‹ë‹¨</li>
              <li>ë‚˜ë§Œì˜ ê±´ê°• ìŠµê´€ê³¼ ê¿€íŒ</li>
            </ul>
          </div>
          <textarea id="habit-salon-free-content" 
                    placeholder="ê±´ê°•ê³¼ ê´€ë ¨ëœ ìì„¸í•œ ê²½í—˜ê³¼ ë…¸í•˜ìš°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”. (100ì ì´ìƒ)" 
                    maxlength="500"></textarea>
          <div class="char-counter">0/500</div>
          <div class="char-count-guide">ë” ìì„¸í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”! (100ì í•„ìš”)</div>
          <div class="modal-footer">
            <div class="point-info">ğŸ’¡ 100ì ì´ìƒ ì‘ì„± ì‹œ 100Pê°€ ì ë¦½ë©ë‹ˆë‹¤!</div>
            <div class="modal-actions">
              <button type="button" class="cancel-btn" onclick="window.closeWriteModal()">ì·¨ì†Œ</button>
              <button type="submit" class="submit-btn" disabled>
                <span>ê±´ê°• ì´ì•¼ê¸° ê³µìœ í•˜ê¸°</span>
                <span class="point-badge">+100P</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="container">
    <img src="assets/img/logo.png" alt="ëŠ˜ë´„ ë¡œê³ " class="logo">
    <div id="main-section">
      <div class="start-screen">
        <h1 class="main-title">ë‚˜ë¥¼ ìœ„í•œ ì‘ì€ ìŠµê´€ì˜ ë³€í™”, ëŠ˜ë´„</h1>
        <p class="sub-title">ì˜¤ëŠ˜ë„ ë‚˜ë¥¼ ëŒë³´ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•, ì‹œì‘í•´ë³¼ê¹Œìš”?</p>
        <div style="text-align:center;">
          <div class="share-section">
            <h3 class="share-title">ì¹œêµ¬ì™€ í•¨ê»˜ ê±´ê°•í•œ ìŠµê´€ ë§Œë“¤ê¸°</h3>
            <div class="social-share-buttons-wrapper">
              <div class="social-share-buttons">
                <button onclick="shareAppInstall()" class="social-btn install-btn">
                  <span class="install-icon-wrap"><img src="assets/img/icon-512.png" alt="ì•±ì„¤ì¹˜" class="install-icon" /></span>
                  <span class="install-btn-text">ì•± ì„¤ì¹˜ ë§í¬ ê³µìœ </span>
                </button>
              </div>
            </div>
            <p class="share-reward">ê³µìœ í•˜ë©´ 200Pê°€ ì ë¦½ë©ë‹ˆë‹¤! ğŸ’š</p>
          </div>
        </div>
        <div class="points-info">
          <p class="current-points">
            ğŸ’š í˜„ì¬ ë‚˜ì˜ ìŠµê´€ í¬ì¸íŠ¸: <strong class="point-value" id="points">0</strong>P
          </p>
          <div class="points-guide">
            <p class="point-main-text">
              ğŸ“Œ <strong class="point-highlight">5,000í¬ì¸íŠ¸</strong>ë¥¼ ë‹¬ì„±í•˜ë©´
              <strong>ëŠ˜ë´„ëª° ì ë¦½ê¸ˆìœ¼ë¡œ ì „í™˜</strong>í•  ìˆ˜ ìˆì–´ìš”!
            </p>
            <p class="point-sub-text">
              í™˜ì „ ì‹ ì²­ ë²„íŠ¼ì€ <strong class="point-emphasis">5,000P ì´ìƒ</strong>ì¼ ë•Œ ìë™ìœ¼ë¡œ í™œì„±í™”ë©ë‹ˆë‹¤
            </p>
          </div>
          <div id="points-action">
            <button id="habit-salon-enter-btn" class="primary-button" style="margin-bottom:12px;background:#356c55;">ğŸŒ¿ ëŠ˜ë´„ ìŠµê´€ì‚´ë¡±</button>
            <button onclick="location.href='quiz.html'" class="primary-button">
              ì˜¤ëŠ˜ì˜ ê±´ê°• ë£¨í‹´ ì‹œì‘í•˜ê¸° â†’
            </button>
            <button onclick="requestExchange()" id="exchange-button" class="secondary-button" style="display: none;">
              âœ¨ í¬ì¸íŠ¸ ì „í™˜ ì‹ ì²­í•˜ê¸°
            </button>
            <button onclick="window.open('https://smartstore.naver.com/jinjjamall', '_blank')" class="secondary-button" style="margin-top:10px;">
              ğŸ›’ ëŠ˜ë´„ì‹í’ˆ ë°”ë¡œê°€ê¸°
            </button>
            <button onclick="goToShorts()" class="secondary-button" style="margin-top:10px;">
              ğŸ¥ 1ë¶„ ê±´ê°• ìˆì¸  ë³´ëŸ¬ê°€ê¸°
            </button>
            
            <div id="points-insufficient" class="points-notice" style="display: none;">
              í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ ğŸ˜¢
            </div>
          </div>
        </div>
        <div class="card-grid">
          <div class="info-card">
            <span class="emoji">âœ¨</span>
            <h3>ì‘ì€ ì‹¤ì²œ</h3>
            <p>ì‹¤ì²œí• ìˆ˜ë¡ ìŒ“ì´ëŠ” ìŠµê´€ í¬ì¸íŠ¸<br>ì˜¤ëŠ˜ì˜ ë‚˜ë¥¼ ìœ„í•œ ì‘ì€ íˆ¬ì</p>
          </div>
          <div class="info-card">
            <span class="emoji">ğŸŒ±</span>
            <h3>ê±´ê°•í•œ ë£¨í‹´</h3>
            <p>ì ê¹ì˜ ì—¬ìœ , ë‚˜ë¥¼ ì±™ê¸°ëŠ” ìŠµê´€<br>í•˜ë£¨ í•œ ë²ˆì¯¤, ë‚˜ë¥¼ ìœ„í•œ ì²´í¬íƒ€ì„!</p>
          </div>
          <div class="info-card">
            <span class="emoji">ğŸ</span>
            <h3>ë‚˜ë¥¼ ìœ„í•œ ì„ ë¬¼</h3>
            <p>ê±´ê°• í€´ì¦ˆë¡œ ì•Œì•„ë³´ëŠ” ë‚´ ëª¸ ì‚¬ìš© ì„¤ëª…ì„œ<br>ì•Œë©´ ì§€í‚¤ê²Œ ë˜ëŠ” ê±´ê°• ìƒì‹!</p>
          </div>
        </div>
        <p class="footer-quote">ì‘ì€ ìŠµê´€ì´, ê²°êµ­ ê°€ì¥ ë©€ë¦¬ ê°‘ë‹ˆë‹¤</p>
      </div>
    </div>
    <div class="video-section" id="shorts-section" style="display:none;">
      <h3 class="video-title">ğŸ¥ 1ë¶„ ê±´ê°• ìˆì¸ </h3>
      <ul id="videoList" class="video-list"></ul>
      <button onclick="goBackMain()" class="secondary-button" style="margin-top:20px;">â† ë’¤ë¡œê°€ê¸°</button>
    </div>

    <!-- ëŠ˜ë´„ ìŠµê´€ì‚´ë¡± ë©”ì¸ ì„¹ì…˜ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
    <div id="habit-salon-main" style="display:none;max-width:700px;margin:40px auto 40px auto;padding:0 8px;">
      <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
      <div style="display:flex;justify-content:flex-end;padding:16px 0;margin-bottom:20px;">
        <button id="habit-salon-main-back-btn" style="padding:8px 16px;background:#e0ede3;color:#356c55;border:none;border-radius:8px;font-size:14px;font-weight:600;">â† ë’¤ë¡œê°€ê¸°</button>
      </div>
      
      <!-- ì„¹ì…˜ ë„¤ë¹„ê²Œì´ì…˜ ì¹´ë“œ -->
      <div id="habit-salon-nav-cards" style="display:flex;gap:16px;justify-content:space-between;margin-bottom:32px;flex-wrap:wrap;">
        <div class="habit-salon-nav-card" data-section="brand" style="flex:1 1 140px;min-width:140px;max-width:180px;background:#fff;border-radius:16px;box-shadow:0 2px 8px #e0ede3;padding:18px 10px;display:flex;flex-direction:column;align-items:center;cursor:pointer;transition:box-shadow 0.2s;">
          <img src="assets/img/brand-icon.png" alt="ë¸Œëœë“œ ì´ì•¼ê¸°" style="width:48px;height:48px;margin-bottom:10px;object-fit:contain;"/>
          <div style="font-weight:700;font-size:1.05rem;color:#356c55;">ë¸Œëœë“œ ì´ì•¼ê¸°</div>
        </div>
        <div class="habit-salon-nav-card" data-section="question" style="flex:1 1 140px;min-width:140px;max-width:180px;background:#fff;border-radius:16px;box-shadow:0 2px 8px #e0ede3;padding:18px 10px;display:flex;flex-direction:column;align-items:center;cursor:pointer;transition:box-shadow 0.2s;">
          <img src="assets/img/question-icon%20.png" alt="ì˜¤ëŠ˜ì˜ ì§ˆë¬¸" style="width:48px;height:48px;margin-bottom:10px;object-fit:contain;"/>
          <div style="font-weight:700;font-size:1.05rem;color:#356c55;">ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</div>
        </div>
        <div class="habit-salon-nav-card" data-section="free" style="flex:1 1 140px;min-width:140px;max-width:180px;background:#fff;border-radius:16px;box-shadow:0 2px 8px #e0ede3;padding:18px 10px;display:flex;flex-direction:column;align-items:center;cursor:pointer;transition:box-shadow 0.2s;">
          <img src="assets/img/community-icon.png" alt="ê±´ê°• í•œë§ˆë‹¹" style="width:48px;height:48px;margin-bottom:10px;object-fit:contain;"/>
          <div style="font-weight:700;font-size:1.05rem;color:#356c55;">ê±´ê°• í•œë§ˆë‹¹</div>
        </div>
        <div class="habit-salon-nav-card" data-section="challenge" style="flex:1 1 140px;min-width:140px;max-width:180px;background:#fff;border-radius:16px;box-shadow:0 2px 8px #e0ede3;padding:18px 10px;display:flex;flex-direction:column;align-items:center;cursor:pointer;transition:box-shadow 0.2s;opacity:0.6;">
          <img src="assets/img/challenge-icon.png" alt="ìŠµê´€ ì±Œë¦°ì§€" style="width:48px;height:48px;margin-bottom:10px;object-fit:contain;"/>
          <div style="font-weight:700;font-size:1.05rem;color:#356c55;">ìŠµê´€ ì±Œë¦°ì§€</div>
        </div>
      </div>
      <!-- 1ï¸âƒ£ ë¸Œëœë“œ ì´ì•¼ê¸° -->
      <section id="habit-salon-brand" style="display:none;margin-bottom:40px;">
        <h2 style="font-size:1.3rem;color:#356c55;font-weight:700;">ğŸ“– ë¸Œëœë“œ ì´ì•¼ê¸°</h2>
        <div id="habit-salon-brand-list" style="display:flex;flex-direction:column;gap:20px;padding:12px 0 8px 0;"></div>
      </section>

      <!-- 2ï¸âƒ£ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ -->
      <section id="habit-salon-question" style="display:none;margin-bottom:40px;">
        <h2 style="font-size:1.3rem;color:#356c55;font-weight:700;">ğŸ“” ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</h2>
        <div id="habit-salon-question-card" style="background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:12px;"></div>
        <div id="habit-salon-question-comments"></div>
      </section>
      <!-- 3ï¸âƒ£ ê±´ê°• í•œë§ˆë‹¹(ììœ ê¸€) -->
      <section id="habit-salon-free" style="display:none;margin-bottom:40px;">
        <h2 style="font-size:1.3rem;color:#356c55;font-weight:700;">ğŸ’¬ ê±´ê°• í•œë§ˆë‹¹</h2>
        <!-- ìµœì‹ /ì¸ê¸°ìˆœ í† ê¸€ -->
        <div id="free-feed-sort-toggle" style="display:flex;gap:8px;justify-content:center;margin-bottom:16px;">
          <button id="sort-latest-btn" class="feed-sort-btn active">ìµœì‹ ìˆœ</button>
          <button id="sort-popular-btn" class="feed-sort-btn">ì¸ê¸°ìˆœ</button>
        </div>
        <div id="habit-salon-free-list"></div>
      </section>
      <!-- 4ï¸âƒ£ ìŠµê´€ ì±Œë¦°ì§€(ì˜ˆì •) -->
      <section id="habit-salon-challenge" style="display:none;margin-bottom:40px;">
        <h2 style="font-size:1.3rem;color:#356c55;font-weight:700;">ğŸ¯ ìŠµê´€ ì±Œë¦°ì§€ (ì¤€ë¹„ì¤‘)</h2>
        <div style="background:#f8f9fa;padding:20px;border-radius:12px;">ì£¼ê°„ ì‹¤ì²œ ê³¼ì œ, ë£¨í‹´ ê¸°ë¡ ê¸°ëŠ¥ì´ ê³§ ì˜¤í”ˆë©ë‹ˆë‹¤!</div>
      </section>

      <!-- í¬ì¸íŠ¸ ì •ë³´ ë° ë¡œê·¸ -->
      <div style="text-align:center;margin-top:20px;padding:16px;background:#f8f9fa;border-radius:12px;">
        <p style="margin:0;color:#356c55;font-weight:600;">ğŸ’š í˜„ì¬ í¬ì¸íŠ¸: <span id="habit-salon-my-point">0</span>P</p>
      </div>

      <!-- í”¼ë“œë°± ë©”ì‹œì§€ (ê¸°ì¡´ ë°©ì‹ ëŒ€ì‹  í† ìŠ¤íŠ¸ ì‚¬ìš©) -->
      <div id="habit-salon-feedback" style="display:none;"></div>
    </div>

    <!-- ì „ì²´ í™”ë©´ ë¸Œëœë“œ ì´ì•¼ê¸° í˜ì´ì§€ -->
    <div id="brand-story-fullscreen" class="fullscreen-page">
      <div class="fullscreen-page-header">
        <button class="fullscreen-back-btn" onclick="window.closeBrandStoryPage()">
          â† ë’¤ë¡œê°€ê¸°
        </button>
        <h1 class="fullscreen-page-title">ğŸ“– ë¸Œëœë“œ ì´ì•¼ê¸°</h1>
        <div></div>
      </div>
      <div class="fullscreen-page-content">
        <div class="brand-story-container">
          <div id="brand-story-content"></div>
        </div>
      </div>
    </div>

    <!-- ì „ì²´ í™”ë©´ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ í˜ì´ì§€ -->
    <div id="question-fullscreen" class="fullscreen-page">
      <div class="fullscreen-page-header">
        <button class="fullscreen-back-btn" onclick="window.closeQuestionPage()">
          â† ë’¤ë¡œê°€ê¸°
        </button>
        <h1 class="fullscreen-page-title">ğŸ“” ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</h1>
        <div></div>
      </div>
      <div class="fullscreen-page-content">
        <div id="question-content"></div>
      </div>
    </div>

    <!-- ì „ì²´ í™”ë©´ ê±´ê°• í•œë§ˆë‹¹(ììœ ê¸€) í˜ì´ì§€ -->
    <div id="free-fullscreen" class="fullscreen-page">
      <div class="fullscreen-page-header">
        <button class="fullscreen-back-btn" onclick="window.closeFreePage()">
          â† ë’¤ë¡œê°€ê¸°
        </button>
        <h1 class="fullscreen-page-title">ğŸ’¬ ê±´ê°• í•œë§ˆë‹¹</h1>
        <div></div>
      </div>
      <div class="fullscreen-page-content">
        <div id="free-content">
          <div class="card-feed-list">
            ${posts.map((post, index) => `
              <div class="feed-card" data-post-id="${post.id}">
                <div class="feed-card-content">
                  <div class="feed-card-meta">
                    <div class="feed-card-author">
                      <div class="feed-card-avatar">ìµ</div>
                      <div class="feed-card-author-info">
                        <div class="feed-card-author-name">ìµëª…</div>
                        <div class="feed-card-time">${window.formatTime(post.timestamp)}</div>
                      </div>
                    </div>
                  </div>
                  <div class="feed-card-text">${post.content}</div>
                  <div class="feed-card-actions">
                    <button class="story-action-btn" onclick="window.toggleStoryLike('free', '${post.id}')">
                      <span id="like-icon-free-${post.id}">${post.isLiked?'â¤ï¸':'ğŸ¤'}</span>
                      <span id="like-count-free-${post.id}">${post.likes || 0}</span>
                    </button>
                    <button class="story-action-btn comment-btn" onclick="window.toggleComments('free', '${post.id}')">
                      <span>ğŸ’¬</span>
                      <span id="comment-count-free-${post.id}">${post.commentCount || 0}</span>
                    </button>
                  </div>
                  <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
                  <div class="story-comments-section" id="comments-free-${post.id}">
                    <div class="story-comments-header">
                      <h3>ëŒ“ê¸€ <span id="comment-header-count-free-${post.id}">${post.commentCount || 0}</span>ê°œ</h3>
                    </div>
                    <!-- ëŒ“ê¸€ ì…ë ¥ -->
                    <div class="story-comment-form">
                      <textarea id="comment-input-free-${post.id}" 
                               placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 200ì)"
                               maxlength="200"></textarea>
                      <button class="story-comment-submit" onclick="window.submitStoryComment('free', '${post.id}')">ë“±ë¡</button>
                    </div>
                    <!-- ëŒ“ê¸€ ëª©ë¡ -->
                    <div class="story-comments-list" id="comment-list-free-${post.id}"></div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
      <!-- í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼ -->
      <button id="floating-write-btn" class="floating-write-btn" title="ê¸€ì“°ê¸°" onclick="window.openWriteModal()">+</button>
    </div>

    <!-- í˜ì´ì§€ ì „í™˜ ì˜¤ë²„ë ˆì´ -->
    <div id="page-transition-overlay" class="page-transition-overlay"></div>

    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ (ë‹¨ì¼) -->
    <div id="free-write-fullscreen" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h2>âœï¸ ê±´ê°• ì´ì•¼ê¸° ì“°ê¸°</h2>
          <button class="modal-close-btn" onclick="window.closeWriteModal()">Ã—</button>
        </div>
        <div class="modal-body">
          <form id="habit-salon-free-form">
            <textarea id="habit-salon-free-content" 
                      placeholder="ììœ ë¡­ê²Œ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš” (50ì ì´ìƒ)" 
                      maxlength="500"></textarea>
            <div class="char-counter">0/500</div>
            <div class="modal-footer">
              <div class="point-info">ğŸ’¡ ê¸€ ì‘ì„± ì‹œ 100Pê°€ ì ë¦½ë©ë‹ˆë‹¤!</div>
              <div class="modal-actions">
                <button type="button" class="cancel-btn" onclick="window.closeWriteModal()">ì·¨ì†Œ</button>
                <button type="submit" class="submit-btn" disabled>
                  <span>ê±´ê°• ì´ì•¼ê¸° ê³µìœ í•˜ê¸°</span>
                  <span class="point-badge">+100P</span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- 1. ê¸€ì“°ê¸° ì „ìš© í˜ì´ì§€ HTML ì¶”ê°€ (free-fullscreen ë°”ë¡œ ë‹¤ìŒì—) -->
    <div id="free-write-fullscreen" class="fullscreen-page">
      <div class="fullscreen-page-header">
        <button class="fullscreen-back-btn" onclick="window.closeFreeWritePage()">
          â† ë’¤ë¡œê°€ê¸°
        </button>
        <h1 class="fullscreen-page-title">âœï¸ ê±´ê°• ì´ì•¼ê¸° ì“°ê¸°</h1>
        <div></div>
      </div>
      <div class="fullscreen-page-content">
        <!-- ê¸°ì¡´ í¼ ì œê±° -->
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, getDoc, setDoc, updateDoc, doc, query, where, orderBy, serverTimestamp, deleteDoc, writeBatch, increment, enableNetwork, disableNetwork, connectFirestoreEmulator } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDMgQA6mqaXR_qr9Uyj1-VnC-8qkcj3ZBw",
      authDomain: "neulbom-healt-quiz.firebaseapp.com",
      projectId: "neulbom-healt-quiz",
      storageBucket: "neulbom-healt-quiz.appspot.com",
      messagingSenderId: "300280931247",
      appId: "1:300280931247:web:5516f3bd8e8834304a055a"
    };
    
    console.log('Firebase ì•± ì´ˆê¸°í™” ì¤‘...');
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // ğŸ”¥ Firestore ì˜¤í”„ë¼ì¸ ì§€ì› í™œì„±í™”
    try {
      // ì˜¤í”„ë¼ì¸ ì§€ì†ì„± í™œì„±í™” (ê¸°ë³¸ê°’ì´ì§€ë§Œ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •)
      console.log('Firestore ì˜¤í”„ë¼ì¸ ì§€ì› í™œì„±í™” ì¤‘...');
      
      // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€
      window.isOnline = navigator.onLine;
      
      window.addEventListener('online', () => {
        console.log('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨ - Firestore ì¬ì—°ê²° ì‹œë„');
        window.isOnline = true;
        window.showSalonToast('ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŒ', 'success');
        enableNetwork(db).catch(error => {
          console.log('Firestore ë„¤íŠ¸ì›Œí¬ ì¬í™œì„±í™” ì˜¤ë¥˜:', error);
        });
      });
      
      window.addEventListener('offline', () => {
        console.log('ğŸ“´ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€ - ì˜¤í”„ë¼ì¸ ëª¨ë“œ');
        window.isOnline = false;
        window.showSalonToast('ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'warning');
      });
      
      console.log('ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:', window.isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸');
      
      } catch (error) {
      console.log('Firestore ì˜¤í”„ë¼ì¸ ì„¤ì • ì˜¤ë¥˜:', error);
    }
    
    console.log('ëŠ˜ë´„ ìŠµê´€ì‚´ë¡± Firebase ì—°ë™ ì™„ë£Œ');

    // ì „ì—­ ë³€ìˆ˜ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ window ê°ì²´ì— í• ë‹¹
    window.db = db;
    
    // ì‚¬ìš©ì ID ê´€ë¦¬ (ê¸°ì¡´ script.jsì™€ í†µì¼)
    window.getUserId = function() {
      let userId = localStorage.getItem('userId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('userId', userId);
      }
      return userId;
    };

    // í¬ì¸íŠ¸ ê´€ë¦¬ (ê¸°ì¡´ script.jsì™€ ì—°ë™ + ì˜¤í”„ë¼ì¸ ì§€ì›)
    window.getUserPoints = async function() {
      try {
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì²´í¬
        if (!window.isOnline) {
          console.log('ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë¡œì»¬ í¬ì¸íŠ¸ ì‚¬ìš©');
          return parseInt(localStorage.getItem('points') || '0');
        }
        
        // ê¸°ì¡´ script.jsì˜ points ë³€ìˆ˜ì™€ ë™ê¸°í™”
        const localPoints = parseInt(localStorage.getItem('points') || '0');
        
        const userId = window.getUserId();
        const userDoc = await getDoc(doc(db, 'users', userId));
        
        if (userDoc.exists()) {
          const firestorePoints = userDoc.data().points || 0;
          // Firestoreì™€ ë¡œì»¬ í¬ì¸íŠ¸ ì¤‘ ë” í° ê°’ ì‚¬ìš© (ë°ì´í„° ì†ì‹¤ ë°©ì§€)
          const syncedPoints = Math.max(localPoints, firestorePoints);
          
          if (syncedPoints !== firestorePoints) {
            // Firestore ì—…ë°ì´íŠ¸
            await updateDoc(doc(db, 'users', userId), {
              points: syncedPoints,
              lastActive: serverTimestamp()
            });
          }
          
          localStorage.setItem('points', syncedPoints.toString());
          
          // ê¸°ì¡´ script.jsì˜ points ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸
          if (window.points !== undefined) {
            window.points = syncedPoints;
          }
          
          return syncedPoints;
        } else {
          // ì‚¬ìš©ì ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒì„±
          await setDoc(doc(db, 'users', userId), {
            points: localPoints,
            createdAt: serverTimestamp(),
            lastActive: serverTimestamp()
          });
          return localPoints;
        }
      } catch (error) {
        console.error('í¬ì¸íŠ¸ ì¡°íšŒ ì˜¤ë¥˜:', error);
        console.log('ì˜¤ë¥˜ë¡œ ì¸í•´ ë¡œì»¬ í¬ì¸íŠ¸ ì‚¬ìš©');
        if (error.code === 'failed-precondition' || error.code === 'unavailable') {
          window.showSalonToast('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.', 'warning');
        }
        return parseInt(localStorage.getItem('points') || '0');
      }
    };
    
    window.addUserPoints = async function(pointsToAdd, source = 'habit_salon', actionId = null) {
      try {
        const userId = window.getUserId();
        
        // ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œë„ ë¡œì»¬ í¬ì¸íŠ¸ëŠ” ì—…ë°ì´íŠ¸
        const currentPoints = parseInt(localStorage.getItem('points') || '0');
        const newPoints = Math.max(0, currentPoints + pointsToAdd);
        localStorage.setItem('points', newPoints.toString());
        
        // ê¸°ì¡´ script.jsì˜ points ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸
        if (window.points !== undefined) {
          window.points = newPoints;
        }
        
        // ì˜¤í”„ë¼ì¸ ìƒíƒœë©´ ë¡œì»¬ë§Œ ì—…ë°ì´íŠ¸í•˜ê³  ë¦¬í„´
        if (!window.isOnline) {
          console.log('ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë¡œì»¬ í¬ì¸íŠ¸ë§Œ ì—…ë°ì´íŠ¸:', newPoints);
          // ì˜¤í”„ë¼ì¸ ì•¡ì…˜ì„ íì— ì €ì¥ (ë‚˜ì¤‘ì— ë™ê¸°í™”ìš©)
          const offlineActions = JSON.parse(localStorage.getItem('offlineActions') || '[]');
          offlineActions.push({
            type: 'addPoints',
            pointsToAdd,
            source,
            actionId,
            timestamp: Date.now()
          });
          localStorage.setItem('offlineActions', JSON.stringify(offlineActions));
          return newPoints;
        }
        
        const userRef = doc(db, 'users', userId);
        
        // ì¤‘ë³µ í¬ì¸íŠ¸ ì§€ê¸‰ ë°©ì§€ (actionIdê°€ ìˆëŠ” ê²½ìš°)
        if (actionId) {
          const duplicateCheck = query(
            collection(db, 'pointsHistory'),
            where('userId', '==', userId),
            where('actionId', '==', actionId)
          );
          const duplicateSnapshot = await getDocs(duplicateCheck);
          
          if (!duplicateSnapshot.empty) {
            console.log('ì´ë¯¸ í¬ì¸íŠ¸ê°€ ì§€ê¸‰ëœ ì•¡ì…˜ì…ë‹ˆë‹¤:', actionId);
            window.showSalonToast('ì´ë¯¸ í¬ì¸íŠ¸ë¥¼ ë°›ì€ í™œë™ì…ë‹ˆë‹¤.', 'warning');
            return await window.getUserPoints();
          }
        }
        
        // Firestoreì—ì„œ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
        await updateDoc(userRef, {
          points: newPoints,
          lastActive: serverTimestamp()
        });
        
        // í¬ì¸íŠ¸ ì´ë ¥ì„ pointsHistory ì»¬ë ‰ì…˜ì— ê¸°ë¡
        const historyData = {
          userId: userId,
          points: pointsToAdd,
          action: pointsToAdd > 0 ? 'earn' : 'spend',
          source: source,
          timestamp: serverTimestamp(),
          beforePoints: currentPoints,
          afterPoints: newPoints
        };
        
        if (actionId) {
          historyData.actionId = actionId;
        }
        
        await addDoc(collection(db, 'pointsHistory'), historyData);
        
        // ë©”ì¸ í˜ì´ì§€ í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const mainPointElement = document.getElementById('points');
        if (mainPointElement) {
          mainPointElement.textContent = newPoints;
        }
        
        // ê¸°ì¡´ script.jsì˜ updatePoints í•¨ìˆ˜ í˜¸ì¶œ
        if (typeof updatePoints === 'function') {
          updatePoints();
        }
        
        return newPoints;
      } catch (error) {
        console.error('í¬ì¸íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:', error);
        console.log('ì˜¤ë¥˜ë¡œ ì¸í•´ ë¡œì»¬ í¬ì¸íŠ¸ë§Œ ì—…ë°ì´íŠ¸');
        
        // ì˜¤ë¥˜ ìƒí™©ì—ì„œë„ ë¡œì»¬ í¬ì¸íŠ¸ëŠ” ìœ ì§€
        const currentPoints = parseInt(localStorage.getItem('points') || '0');
        const newPoints = Math.max(0, currentPoints + pointsToAdd);
        localStorage.setItem('points', newPoints.toString());
        
        if (error.code === 'failed-precondition' || error.code === 'unavailable') {
          window.showSalonToast('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œë¡œ ë¡œì»¬ì—ë§Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
        }
        
        // ê¸°ì¡´ script.jsì˜ addPoints í•¨ìˆ˜ ì‚¬ìš©
        if (typeof addPoints === 'function') {
          addPoints(pointsToAdd);
        }
        
        return newPoints;
      }
    };

    // ë¸Œëœë“œ ê²Œì‹œê¸€ ë¡œë”© (ì¸ë±ìŠ¤ ë¬¸ì œ í•´ê²° - ë‹¨ìˆœ ì¿¼ë¦¬ + í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§)
    window.loadBrandPosts = async function() {
      try {
        console.log('Firebaseì—ì„œ ë¸Œëœë“œ ê²Œì‹œê¸€ ë¡œë”© ì¤‘...');
        
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì‹œ ìºì‹œëœ ë°ì´í„° ì‚¬ìš©
        if (!window.isOnline) {
          console.log('ì˜¤í”„ë¼ì¸ ìƒíƒœ - ìºì‹œëœ ë¸Œëœë“œ ê²Œì‹œê¸€ ì‚¬ìš©');
          const cachedData = localStorage.getItem('cached_brand_posts');
          if (cachedData) {
            const posts = JSON.parse(cachedData);
            console.log('ìºì‹œëœ ë¸Œëœë“œ ê²Œì‹œê¸€:', posts.length, 'ê°œ');
            return posts;
          }
          // ìºì‹œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ë°˜í™˜
          return [{
            id: 'offline_brand_1',
            title: 'ëŠ˜ë´„ê³¼ í•¨ê»˜í•˜ëŠ” ê±´ê°•í•œ ìŠµê´€',
            content: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤. ì˜¨ë¼ì¸ ìƒíƒœì—ì„œ ë” ë§ì€ ì½˜í…ì¸ ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.',
            author: 'ëŠ˜ë´„íŒ€',
            timestamp: new Date(),
            likes: 0,
            commentCount: 0,
            isOffline: true
          }];
        }
        
        // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
        
        // ë‹¨ìˆœ ì¿¼ë¦¬ë¡œ ë³€ê²½ (ë³µí•© ì¸ë±ìŠ¤ ë¶ˆí•„ìš”)
        const q = query(collection(db, 'brand_posts'), orderBy('timestamp', 'desc'));
        const snapshot = await getDocs(q);
        
        const posts = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ í•„í„°ë§
          if (data.isPublished === true && data.date === todayStr) {
          posts.push({
            id: doc.id,
              ...data
            });
          }
        });
        
        // ì„±ê³µì ìœ¼ë¡œ ë¡œë”©ë˜ë©´ ìºì‹œì— ì €ì¥
        if (posts.length > 0) {
          localStorage.setItem('cached_brand_posts', JSON.stringify(posts));
          localStorage.setItem('cached_brand_posts_time', Date.now().toString());
        }
        
        console.log('ë¸Œëœë“œ ê²Œì‹œê¸€ ë¡œë”© ì™„ë£Œ:', posts.length, 'ê°œ (í•„í„°ë§ í›„)');
        return posts;
      } catch (error) {
        console.error('ë¸Œëœë“œ ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
        
        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ìºì‹œ ì‚¬ìš©
        const cachedData = localStorage.getItem('cached_brand_posts');
        if (cachedData) {
          console.log('ì˜¤ë¥˜ë¡œ ì¸í•´ ìºì‹œëœ ë¸Œëœë“œ ê²Œì‹œê¸€ ì‚¬ìš©');
          window.showSalonToast('ìºì‹œëœ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.', 'info');
          return JSON.parse(cachedData);
        }
        
        // fallback: ì¡°ê±´ ì—†ì´ ìµœê·¼ ê²Œì‹œê¸€ë§Œ
        try {
          const q = query(collection(db, 'brand_posts'), orderBy('timestamp', 'desc'));
          const snapshot = await getDocs(q);
          const posts = [];
          snapshot.forEach((doc) => {
            posts.push({
              id: doc.id,
              ...doc.data()
            });
          });
          console.log('ë¸Œëœë“œ ê²Œì‹œê¸€ fallback ë¡œë”©:', posts.length, 'ê°œ');
          return posts.slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
        } catch (fallbackError) {
          console.error('ë¸Œëœë“œ ê²Œì‹œê¸€ fallback ë¡œë”© ì˜¤ë¥˜:', fallbackError);
          // ìµœì¢… fallback - ê¸°ë³¸ ë©”ì‹œì§€
          return [{
            id: 'error_brand_1',
            title: 'ì—°ê²° ì˜¤ë¥˜',
            content: 'í˜„ì¬ ì„œë²„ì™€ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
            author: 'ì‹œìŠ¤í…œ',
            timestamp: new Date(),
            likes: 0,
            commentCount: 0,
            isError: true
          }];
        }
      }
    };
    
    // ê±´ê°• ì§ˆë¬¸ ë¡œë”© (ì¸ë±ìŠ¤ ë¬¸ì œ í•´ê²° - ë‹¨ìˆœ ì¿¼ë¦¬ + í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§)
    window.loadHealthQuestions = async function() {
      try {
        console.log('Firebaseì—ì„œ ê±´ê°• ì§ˆë¬¸ ë¡œë”© ì¤‘...');
        
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì‹œ ìºì‹œëœ ë°ì´í„° ì‚¬ìš©
        if (!window.isOnline) {
          console.log('ì˜¤í”„ë¼ì¸ ìƒíƒœ - ìºì‹œëœ ê±´ê°• ì§ˆë¬¸ ì‚¬ìš©');
          const cachedData = localStorage.getItem('cached_health_questions');
          if (cachedData) {
            const questions = JSON.parse(cachedData);
            console.log('ìºì‹œëœ ê±´ê°• ì§ˆë¬¸:', questions.length, 'ê°œ');
            return questions;
          }
          // ìºì‹œê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ì§ˆë¬¸ ë°˜í™˜
          return [{
            id: 'offline_question_1',
            question: 'ì˜¤ëŠ˜ ì¶©ë¶„í•œ ìˆ˜ë¶„ì„ ì„­ì·¨í•˜ì…¨ë‚˜ìš”?',
            options: [
              'ë„¤, ì¶©ë¶„íˆ ë§ˆì…¨ì–´ìš” ğŸ’§',
              'ì ë‹¹íˆ ë§ˆì…¨ì–´ìš” ğŸ¥¤',
              'ë¶€ì¡±í–ˆì–´ìš” ğŸ˜…',
              'ê±°ì˜ ë§ˆì‹œì§€ ì•Šì•˜ì–´ìš” ğŸ’¦'
            ],
            timestamp: new Date(),
            responses: 0,
            isOffline: true
          }];
        }
        
        // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
        
        // ë‹¨ìˆœ ì¿¼ë¦¬ë¡œ ë³€ê²½ (ë³µí•© ì¸ë±ìŠ¤ ë¶ˆí•„ìš”)
        const q = query(collection(db, 'health_questions'), orderBy('timestamp', 'desc'));
        const snapshot = await getDocs(q);
        
        const questions = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ í•„í„°ë§
          if (data.isPublished === true && data.date === todayStr) {
          questions.push({
            id: doc.id,
              ...data
            });
          }
        });
        
        // ì„±ê³µì ìœ¼ë¡œ ë¡œë”©ë˜ë©´ ìºì‹œì— ì €ì¥
        if (questions.length > 0) {
          localStorage.setItem('cached_health_questions', JSON.stringify(questions));
          localStorage.setItem('cached_health_questions_time', Date.now().toString());
        }
        
        console.log('ê±´ê°• ì§ˆë¬¸ ë¡œë”© ì™„ë£Œ:', questions.length, 'ê°œ (í•„í„°ë§ í›„)');
        return questions;
      } catch (error) {
        console.error('ê±´ê°• ì§ˆë¬¸ ë¡œë”© ì˜¤ë¥˜:', error);
        
        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ìºì‹œ ì‚¬ìš©
        const cachedData = localStorage.getItem('cached_health_questions');
        if (cachedData) {
          console.log('ì˜¤ë¥˜ë¡œ ì¸í•´ ìºì‹œëœ ê±´ê°• ì§ˆë¬¸ ì‚¬ìš©');
          window.showSalonToast('ìºì‹œëœ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.', 'info');
          return JSON.parse(cachedData);
        }
        
        // fallback: ì¡°ê±´ ì—†ì´ ìµœê·¼ ì§ˆë¬¸ë§Œ
        try {
          const q = query(collection(db, 'health_questions'), orderBy('timestamp', 'desc'));
          const snapshot = await getDocs(q);
          const questions = [];
          snapshot.forEach((doc) => {
            questions.push({
              id: doc.id,
              ...doc.data()
            });
          });
          console.log('ê±´ê°• ì§ˆë¬¸ fallback ë¡œë”©:', questions.length, 'ê°œ');
          return questions.slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
        } catch (fallbackError) {
          console.error('ê±´ê°• ì§ˆë¬¸ fallback ë¡œë”© ì˜¤ë¥˜:', fallbackError);
          // ìµœì¢… fallback - ê¸°ë³¸ ì§ˆë¬¸
          return [{
            id: 'error_question_1',
            question: 'í˜„ì¬ ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤',
            options: [
              'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”',
              'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”'
            ],
            timestamp: new Date(),
            responses: 0,
            isError: true
          }];
        }
      }
    };
    
    // ììœ ê²Œì‹œê¸€ ë¡œë”© (ì›ë˜ ì„¤ê³„ëŒ€ë¡œ)
    window.loadUserPosts = async function() {
      try {
        console.log('Firebaseì—ì„œ ììœ ê²Œì‹œê¸€ ë¡œë”© ì¤‘...');
        const q = query(collection(db, 'user_posts'), orderBy('timestamp', 'desc'));
        const snapshot = await getDocs(q);
        
        const posts = [];
        snapshot.forEach((doc) => {
          posts.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        console.log('ììœ ê²Œì‹œê¸€ ë¡œë”© ì™„ë£Œ:', posts.length, 'ê°œ');
        return posts;
      } catch (error) {
        console.error('ììœ ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
        return [];
      }
    };

    // ìƒˆ ììœ ê²Œì‹œê¸€ ì‘ì„±
    window.addUserPost = async function(content) {
      try {
        const userId = window.getUserId();
        const docRef = await addDoc(collection(db, 'user_posts'), {
          content: content,
          author: 'ìµëª…',
          userId: userId,
          timestamp: serverTimestamp(),
          likes: 0,
          commentCount: 0
        });
        
        console.log('ììœ ê²Œì‹œê¸€ ì‘ì„± ì™„ë£Œ:', docRef.id);
        
        // í¬ì¸íŠ¸ ì§€ê¸‰
        await window.addUserPoints(100);
        
        return docRef.id;
      } catch (error) {
        console.error('ììœ ê²Œì‹œê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        throw error;
      }
    };

    // ëŒ“ê¸€ ì¶”ê°€ (ì›ë˜ ì„¤ê³„ëŒ€ë¡œ)
    window.addComment = async function(postType, postId, comment) {
      try {
        const userId = window.getUserId();
        const commentData = {
          content: comment,
          author: 'ìµëª…',
          userId: userId,
          postId: postId,
          postType: postType,
          timestamp: serverTimestamp()
        };
        
        // ëŒ“ê¸€ ì €ì¥
        const docRef = await addDoc(collection(db, 'comments'), commentData);
        console.log('ëŒ“ê¸€ ì‘ì„± ì™„ë£Œ:', docRef.id);
        
        // ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
        const postCollection = postType === 'brand' ? 'brand_posts' : 
                              postType === 'question' ? 'health_questions' : 'user_posts';
        await updateDoc(doc(db, postCollection, postId), {
          commentCount: increment(1)
        });
        
        // í¬ì¸íŠ¸ ì§€ê¸‰ì€ ì—¬ê¸°ì„œë§Œ ì‹¤í–‰ (30P)
        const actionId = `comment_${postType}_${postId}_${Date.now()}`;
        await window.addUserPoints(30, 'comment', actionId);
        
        return {
          id: docRef.id,
          ...commentData,
          timestamp: new Date()
        };
      } catch (error) {
        console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        throw error;
      }
    };
    
    // ëŒ“ê¸€ ì¡°íšŒ (ì›ë˜ ì„¤ê³„ëŒ€ë¡œ)
    window.getComments = async function(postType, postId) {
      try {
        console.log('ëŒ“ê¸€ ì¡°íšŒ ì‹œë„:', { postType, postId });
        const q = query(
          collection(db, 'comments'), 
          where('postId', '==', postId),
          where('postType', '==', postType),
          orderBy('timestamp', 'desc')  // ìµœì‹ ìˆœìœ¼ë¡œ ë³€ê²½
        );
        
        const snapshot = await getDocs(q);
        const comments = [];
        
        snapshot.forEach((doc) => {
          const data = doc.data();
          comments.push({
            id: doc.id,
            ...data,
            timestamp: data.timestamp?.toDate() || new Date()
          });
        });
        
        console.log('ëŒ“ê¸€ ì¡°íšŒ ê²°ê³¼:', comments.length, 'ê°œ');
        return comments;
      } catch (error) {
        console.error('ëŒ“ê¸€ ì¡°íšŒ ì˜¤ë¥˜:', error);
        return [];
      }
    };

    // ì¢‹ì•„ìš” ê¸°ëŠ¥ (Firestore ì—°ë™)
    window.toggleLike = async function(postType, postId) {
      try {
        const userId = window.getUserId();
        const likeId = `${userId}_${postType}_${postId}`;
        const likeRef = doc(db, 'likes', likeId);
        const likeDoc = await getDoc(likeRef);
        
        const postCollection = postType === 'brand' ? 'brand_posts' : 
                              postType === 'question' ? 'health_questions' : 'user_posts';
        const postRef = doc(db, postCollection, postId);
        
        if (likeDoc.exists()) {
          // ì¢‹ì•„ìš” ì·¨ì†Œ
          await deleteDoc(likeRef);
          await updateDoc(postRef, {
            likes: increment(-1)
          });
          localStorage.removeItem(`like_${postType}_${postId}`);
          return false;
        } else {
          // ì¢‹ì•„ìš” ì¶”ê°€
          await setDoc(likeRef, {
            userId: userId,
            postType: postType,
            postId: postId,
            timestamp: serverTimestamp()
          });
          await updateDoc(postRef, {
            likes: increment(1)
          });
          localStorage.setItem(`like_${postType}_${postId}`, 'true');
          return true;
        }
      } catch (error) {
        console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë§Œ ì‚¬ìš©
      const likeKey = `like_${postType}_${postId}`;
      const isLiked = localStorage.getItem(likeKey) === 'true';
      
      if (isLiked) {
        localStorage.removeItem(likeKey);
        return false;
      } else {
        localStorage.setItem(likeKey, 'true');
        return true;
        }
      }
    };
    
    window.isLiked = async function(postType, postId) {
      try {
        const userId = window.getUserId();
        const likeId = `${userId}_${postType}_${postId}`;
        const likeDoc = await getDoc(doc(db, 'likes', likeId));
        return likeDoc.exists();
      } catch (error) {
        console.error('ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
      return localStorage.getItem(`like_${postType}_${postId}`) === 'true';
      }
    };

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (ê³ ë„í™”ëœ ë²„ì „)
    window.showSalonToast = function(message, type = 'success') {
      // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
      const existingToast = document.querySelector('.salon-toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = `salon-toast ${type}`;
      
      const icons = {
        success: 'âœ…',
        error: 'âŒ',
        warning: 'âš ï¸',
        info: 'â„¹ï¸'
      };
      
      toast.innerHTML = `
        <div class="salon-toast-content">
          <span class="salon-toast-icon">${icons[type] || icons.success}</span>
          <span class="salon-toast-message">${message}</span>
        </div>
      `;
      
      toast.style.animation = 'toastSlideUp 0.4s ease';
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'toastSlideDown 0.4s ease';
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 400);
      }, 3000);
    };

    // ìŠµê´€ì‚´ë¡± ì´ˆê¸°í™”
    window.initHabitSalon = async function() {
      console.log('ìŠµê´€ì‚´ë¡± ì´ˆê¸°í™” ì‹œì‘');
      
      // í¬ì¸íŠ¸ ë™ê¸°í™”
      const points = await window.getUserPoints();
      const pointDisplay = document.getElementById('habit-salon-my-point');
      if (pointDisplay) {
        pointDisplay.textContent = points;
      }
      
      // ë„¤ë¹„ê²Œì´ì…˜ ì¹´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const navCards = document.querySelectorAll('.habit-salon-nav-card');
      navCards.forEach(card => {
        card.addEventListener('click', function() {
          const section = this.dataset.section;
          if (section === 'brand') {
            window.openBrandStoryPage();
          } else if (section === 'question') {
            window.openQuestionPage();
          } else if (section === 'free') {
            window.openFreePage();
          } else {
            window.showHabitSalonSection(section);
          }
        });
        
        card.addEventListener('mouseenter', function() {
          this.style.boxShadow = '0 4px 16px rgba(53,108,85,0.15)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.boxShadow = '0 2px 8px #e0ede3';
        });
      });
      
      // ë’¤ë¡œê°€ê¸° ë²„íŠ¼
      const backBtn = document.getElementById('habit-salon-main-back-btn');
      if (backBtn) {
        backBtn.addEventListener('click', function() {
          document.getElementById('habit-salon-main').style.display = 'none';
          document.getElementById('main-section').style.display = 'block';
        });
      }
      
      // ììœ ê¸€ í¼ ì´ë²¤íŠ¸
      const freeForm = document.getElementById('habit-salon-free-form');
      if (freeForm) {
        freeForm.addEventListener('submit', window.handleFreePostSubmit);
      }
      
      console.log('ìŠµê´€ì‚´ë¡± ì´ˆê¸°í™” ì™„ë£Œ');
    };

    // ìŠµê´€ì‚´ë¡± ì„¹ì…˜ í‘œì‹œ
    window.showHabitSalonSection = async function(sectionName) {
      // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      const sections = ['brand', 'question', 'free', 'challenge'];
      sections.forEach(section => {
        const element = document.getElementById(`habit-salon-${section}`);
        if (element) element.style.display = 'none';
      });
      
      // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
      const targetSection = document.getElementById(`habit-salon-${sectionName}`);
      if (targetSection) {
        targetSection.style.display = 'block';
        
        // ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë”©
        switch(sectionName) {
          case 'brand':
            await window.loadBrandSection();
            break;
          case 'question':
            await window.loadQuestionSection();
            break;
          case 'free':
            await window.loadFreeSection();
            break;
          case 'challenge':
            // ì¤€ë¹„ì¤‘ ë©”ì‹œì§€ëŠ” ì´ë¯¸ HTMLì— ìˆìŒ
            break;
        }
      }
    };

    // ì¹´ë“œ ìŠ¬ë¼ì´ë” ìƒíƒœ ê´€ë¦¬
    let currentCardIndex = 0;
    let currentCards = [];
    let currentSection = '';

    // ë¸Œëœë“œ ì„¹ì…˜ ë¡œë”© (ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ì¹´ë“œ)
    window.loadBrandSection = async function() {
      const container = document.getElementById('habit-salon-brand-list');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const posts = await window.loadBrandPosts();
        
        if (posts.length === 0) {
          container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì˜¤ëŠ˜ì˜ ë¸Œëœë“œ ì´ì•¼ê¸°ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</div>';
          return;
        }
        
        currentCards = posts;
        currentSection = 'brand';
        currentCardIndex = 0;
        
        container.innerHTML = `
          <div class="card-slider-container">
            <div class="card-slider" id="brand-card-slider">
              ${posts.map((post, index) => `
                <div class="story-card" data-index="${index}">
                  ${post.imageUrl ? `<img src="${post.imageUrl}" alt="ë¸Œëœë“œ ì´ë¯¸ì§€" class="story-card-image">` : 
                    '<div class="story-card-image" style="display:flex;align-items:center;justify-content:center;font-size:48px;">ğŸŒ¿</div>'}
                  <div class="story-card-content">
                    <h3 class="story-card-title">${post.title || 'ëŠ˜ë´„ ë¸Œëœë“œ ì´ì•¼ê¸°'}</h3>
                    <p class="story-card-text">${post.content}</p>
                    <div class="story-card-meta">
                      <div class="story-card-author">
                        <div class="story-card-avatar">ëŠ˜</div>
                        <div class="story-card-author-info">
                          <div class="story-card-author-name">${post.author || 'ëŠ˜ë´„íŒ€'}</div>
                          <div class="story-card-time">${window.formatTime(post.timestamp)}</div>
                        </div>
                      </div>
                      <div class="story-card-actions">
                        <button class="story-action-btn" onclick="window.toggleStoryLike('brand', '${post.id}', ${index})">
                          <span id="like-icon-brand-${index}">â¤ï¸</span>
                          <span id="like-count-brand-${index}">${post.likes || 0}</span>
                        </button>
                        <button class="story-action-btn comment-btn" onclick="window.toggleStoryComments('brand', '${post.id}', ${index})">
                          <span>ğŸ’¬</span>
                          <span id="comment-count-brand-${index}">${post.commentCount || 0}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="story-comments-section active" id="comments-brand-${index}">
                    <div class="story-comments-header">
                      ëŒ“ê¸€ <span id="comment-header-count-brand-${index}">${post.commentCount || 0}</span>ê°œ
                    </div>
                    <div class="story-comments-list" id="comment-list-brand-${index}">
                      <!-- ëŒ“ê¸€ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="story-comment-input">
                      <div class="story-comment-form">
                        <textarea id="comment-input-brand-${index}" class="story-comment-textarea" 
                                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... (+30P)" maxlength="200"></textarea>
                        <button onclick="window.submitStoryComment('brand', '${post.id}', ${index})" 
                                class="story-comment-submit">ë“±ë¡</button>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            ${posts.length > 1 ? `
              <button class="card-nav prev" onclick="window.prevCard()" id="prev-btn">â€¹</button>
              <button class="card-nav next" onclick="window.nextCard()" id="next-btn">â€º</button>
            ` : ''}
          </div>
          ${posts.length > 1 ? `
            <div class="card-indicators">
              ${posts.map((_, index) => `
                <div class="card-indicator ${index === 0 ? 'active' : ''}" 
                     onclick="window.goToCard(${index})" data-index="${index}"></div>
              `).join('')}
            </div>
          ` : ''}
        `;
        
        window.updateCardNavigation();
        
      } catch (error) {
        console.error('ë¸Œëœë“œ ì„¹ì…˜ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#f44336;">ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    };

    // ì§ˆë¬¸ ì„¹ì…˜ ë¡œë”© (ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ì¹´ë“œ)
    window.loadQuestionSection = async function() {
      const container = document.getElementById('habit-salon-question-card');
      const commentsContainer = document.getElementById('habit-salon-question-comments');
      
      if (!container) return;
      
      container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const questions = await window.loadHealthQuestions();
        
        if (questions.length === 0) {
          container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</div>';
          return;
        }
        
        currentCards = questions;
        currentSection = 'question';
        currentCardIndex = 0;
        
        container.innerHTML = `
          <div class="card-slider-container">
            <div class="card-slider" id="question-card-slider">
              ${questions.map((question, index) => `
                <div class="story-card question-card" data-index="${index}">
                  <div class="story-card-content">
                    <h3 class="story-card-title">ğŸ“ ${question.question}</h3>
                    <div class="question-options">
                      ${question.options ? question.options.map((option, optionIndex) => `
                        <button class="question-option" 
                                onclick="window.answerStoryQuestion('${question.id}', ${optionIndex}, ${index})"
                                id="option-${index}-${optionIndex}">
                          ${option}
                        </button>
                      `).join('') : ''}
                    </div>
                    <div class="question-reward">ğŸ’¡ ë‹µë³€í•˜ë©´ 30Pê°€ ì ë¦½ë©ë‹ˆë‹¤!</div>
                  </div>
                  <div class="story-comments-section active" id="comments-question-${index}">
                    <div class="story-comments-header">
                      ëŒ“ê¸€ <span id="comment-header-count-question-${index}">${question.commentCount || 0}</span>ê°œ
                    </div>
                    <div class="story-comments-list" id="comment-list-question-${index}">
                      <!-- ëŒ“ê¸€ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="story-comment-input">
                      <div class="story-comment-form">
                        <textarea id="comment-input-question-${index}" class="story-comment-textarea" 
                                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... (+30P)" maxlength="200"></textarea>
                        <button onclick="window.submitStoryComment('question', '${question.id}', ${index})" 
                                class="story-comment-submit">ë“±ë¡</button>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            ${questions.length > 1 ? `
              <button class="card-nav prev" onclick="window.prevCard()" id="prev-btn">â€¹</button>
              <button class="card-nav next" onclick="window.nextCard()" id="next-btn">â€º</button>
            ` : ''}
          </div>
          ${questions.length > 1 ? `
            <div class="card-indicators">
              ${questions.map((_, index) => `
                <div class="card-indicator ${index === 0 ? 'active' : ''}" 
                     onclick="window.goToCard(${index})" data-index="${index}"></div>
              `).join('')}
            </div>
          ` : ''}
        `;
        
        if (commentsContainer) {
          commentsContainer.innerHTML = '';
        }
        
        window.updateCardNavigation();
        
      } catch (error) {
        console.error('ì§ˆë¬¸ ì„¹ì…˜ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#f44336;">ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    };

    // ììœ  ì„¹ì…˜ ë¡œë”© (ì¸ìŠ¤íƒ€ ìŠ¤íƒ€ì¼ ì¹´ë“œ)
    window.loadFreeSection = async function() {
      const container = document.getElementById('habit-salon-free-list');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ë¡œë”© ì¤‘...</div>';
      
      try {
        const posts = await window.loadUserPosts();
        
        if (posts.length === 0) {
          container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì²« ë²ˆì§¸ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
          return;
        }
        
        // í”¼ë“œ ë Œë”ë§
        let html = '<div class="feed-list">';
        html += posts.map((post, index) => `
          <div class="feed-card">
            <div class="feed-card-header">
              <div class="feed-author">ìµëª…</div>
              <div class="feed-time">${window.formatTime(post.timestamp)}</div>
            </div>
            <div class="feed-content">${post.content}</div>
            <div class="feed-actions">
              <button onclick="window.toggleLike('${post.id}')" class="feed-action-btn">
                ${post.isLiked ? 'â¤ï¸' : 'ğŸ¤'} ${post.likes || 0}
              </button>
              <button onclick="window.toggleComments('${post.id}')" class="feed-action-btn">
                ğŸ’¬ ${post.commentCount || 0}
              </button>
            </div>
          </div>
        `).join('');
        html += '</div>';
        
        container.innerHTML = html;
        
      } catch (error) {
        console.error('í”¼ë“œ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#f44336;">ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    };

    // ììœ ê¸€ ì‘ì„± ì²˜ë¦¬
    window.handleFreePostSubmit = async function(e) {
      e.preventDefault();
      
      const textarea = document.getElementById('habit-salon-free-content');
      const content = textarea.value.trim();
      
      if (content.length < 50) {
        window.showSalonToast('50ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      try {
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'ì‘ì„± ì¤‘...';
        
        await window.addUserPost(content);
        
        textarea.value = '';
        window.showSalonToast('ììœ ê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! +100P ì ë¦½ ğŸ‰');
        
        // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const points = await window.getUserPoints();
        const pointDisplay = document.getElementById('habit-salon-my-point');
        if (pointDisplay) {
          pointDisplay.textContent = points;
        }
        
        // ììœ  ì„¹ì…˜ ìƒˆë¡œê³ ì¹¨
        await window.loadFreeSection();
        
      } catch (error) {
        console.error('ììœ ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        window.showSalonToast('ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = false;
        submitBtn.textContent = 'ììœ ê¸€ ì‘ì„± (+100P)';
      }
    };

    // ëŒ“ê¸€ í† ê¸€
    window.toggleComments = async function(postType, postId) {
      console.log('ëŒ“ê¸€ í† ê¸€:', { postType, postId });
      
      const commentsSection = document.getElementById(`comments-${postType}-${postId}`);
      if (!commentsSection) {
        console.error('ëŒ“ê¸€ ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const isVisible = commentsSection.classList.contains('active');
      
      if (!isVisible) {
        // ëŒ“ê¸€ ì„¹ì…˜ í‘œì‹œ
        commentsSection.classList.add('active');
        
        // ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ
        await window.loadStoryComments(postType, postId);
        
        // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
        const input = document.getElementById(`comment-input-${postType}-${postId}`);
        if (input) {
          input.focus();
        }
      } else {
        // ëŒ“ê¸€ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        commentsSection.classList.remove('active');
      }
    };

    // ëŒ“ê¸€ ë¡œë”©
    window.loadComments = async function(postType, postId) {
      const container = document.getElementById(`comment-list-${postType}-${postId}`);
      if (!container) return;
      
      try {
        const comments = await window.getComments(postType, postId);
        
        container.innerHTML = comments.map(comment => `
          <div class="feed-comment">
            <div class="feed-comment-avatar">${comment.author.charAt(0)}</div>
            <div class="feed-comment-content">
              <div class="feed-comment-header">
                <span class="feed-comment-author">${comment.author}</span>
                <span class="feed-comment-time">${window.formatTime(comment.timestamp)}</span>
              </div>
              <div class="feed-comment-text">${comment.content}</div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('ëŒ“ê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="color:#f44336;padding:10px;">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
    };

    // ëŒ“ê¸€ ì‘ì„±
    window.submitComment = async function(postType, postId) {
      const input = document.getElementById(`comment-input-${postType}-${postId}`);
      const content = input.value.trim();
      
      if (!content) {
        window.showSalonToast('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      if (content.length > 200) {
        window.showSalonToast('ëŒ“ê¸€ì€ 200ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      try {
        const submitBtn = input.nextElementSibling;
        submitBtn.disabled = true;
        submitBtn.textContent = 'ë“±ë¡ ì¤‘...';
        
        await window.addComment(postType, postId, content);
        
        input.value = '';
        const charCount = document.getElementById(`char-count-${postType}-${postId}`);
        if (charCount) charCount.textContent = '0/200';
        
        window.showSalonToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! +50P ì ë¦½ ğŸ‰');
        
        // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const points = await window.getUserPoints();
        const pointDisplay = document.getElementById('habit-salon-my-point');
        if (pointDisplay) {
          pointDisplay.textContent = points;
        }
        
        // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        await window.loadComments(postType, postId);
        
        // ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
        const countElement = document.getElementById(`comment-count-${postType}-${postId}`);
        if (countElement) {
          const currentCount = parseInt(countElement.textContent) || 0;
          countElement.textContent = currentCount + 1;
          countElement.classList.add('comment-count-update');
          setTimeout(() => {
            countElement.classList.remove('comment-count-update');
          }, 300);
        }
        
      } catch (error) {
        console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        window.showSalonToast('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        const submitBtn = input.nextElementSibling;
        submitBtn.disabled = false;
        submitBtn.textContent = 'ë“±ë¡';
      }
    };

    // ì¢‹ì•„ìš” í† ê¸€
    window.togglePostLike = async function(postType, postId) {
      try {
        const isLiked = await window.toggleLike(postType, postId);
        const likeElement = document.getElementById(`likes-${postType}-${postId}`);
        
        if (likeElement) {
          const currentLikes = parseInt(likeElement.textContent) || 0;
          likeElement.textContent = isLiked ? currentLikes + 1 : Math.max(0, currentLikes - 1);
        }
        
        window.showSalonToast(isLiked ? 'ì¢‹ì•„ìš”! â¤ï¸' : 'ì¢‹ì•„ìš” ì·¨ì†Œ');
        
      } catch (error) {
        console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        window.showSalonToast('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };

    // ì§ˆë¬¸ ë‹µë³€
    window.answerQuestion = async function(questionId, optionIndex) {
      try {
        // ë‹µë³€ ê¸°ë¡
        await addDoc(collection(db, 'question_answers'), {
          questionId: questionId,
          optionIndex: optionIndex,
          userId: window.getUserId(),
          timestamp: serverTimestamp()
        });
        
        // í¬ì¸íŠ¸ ì§€ê¸‰
        await window.addUserPoints(30);
        
        window.showSalonToast('ë‹µë³€ ì™„ë£Œ! +30P ì ë¦½ ğŸ‰');
        
        // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const points = await window.getUserPoints();
        const pointDisplay = document.getElementById('habit-salon-my-point');
        if (pointDisplay) {
          pointDisplay.textContent = points;
        }
        
        // ë²„íŠ¼ ë¹„í™œì„±í™”
        const buttons = document.querySelectorAll(`button[onclick*="${questionId}"]`);
        buttons.forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = '0.6';
        });
        
      } catch (error) {
        console.error('ì§ˆë¬¸ ë‹µë³€ ì˜¤ë¥˜:', error);
        window.showSalonToast('ë‹µë³€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };

    // ì‹œê°„ í¬ë§·íŒ…
    window.formatTime = function(timestamp) {
      if (!timestamp) return 'ë°©ê¸ˆ ì „';
      
      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'ë°©ê¸ˆ ì „';
      if (minutes < 60) return `${minutes}ë¶„ ì „`;
      if (hours < 24) return `${hours}ì‹œê°„ ì „`;
      if (days < 7) return `${days}ì¼ ì „`;
      
      return date.toLocaleDateString();
    };

    console.log('ëŠ˜ë´„ ìŠµê´€ì‚´ë¡± ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
    console.log('ì‚¬ìš©ì ID:', window.getUserId());
    
    // ì¹´ë“œ ìŠ¬ë¼ì´ë” ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
    window.updateCardNavigation = function() {
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const indicators = document.querySelectorAll('.card-indicator');
      
      if (prevBtn) {
        prevBtn.disabled = currentCardIndex === 0;
        prevBtn.style.opacity = currentCardIndex === 0 ? '0.3' : '1';
      }
      
      if (nextBtn) {
        nextBtn.disabled = currentCardIndex === currentCards.length - 1;
        nextBtn.style.opacity = currentCardIndex === currentCards.length - 1 ? '0.3' : '1';
      }
      
      // ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentCardIndex);
      });
      
      // ìŠ¬ë¼ì´ë” ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      const sliders = document.querySelectorAll('.card-slider');
      sliders.forEach(slider => {
        slider.style.transform = `translateX(-${currentCardIndex * 100}%)`;
      });
    };
    
    window.prevCard = function() {
      if (currentCardIndex > 0) {
        currentCardIndex--;
        window.updateCardNavigation();
      }
    };
    
    window.nextCard = function() {
      if (currentCardIndex < currentCards.length - 1) {
        currentCardIndex++;
        window.updateCardNavigation();
      }
    };
    
    window.goToCard = function(index) {
      if (index >= 0 && index < currentCards.length) {
        currentCardIndex = index;
        window.updateCardNavigation();
      }
    };
    
    // ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” í† ê¸€
    window.toggleStoryLike = async function(postType, postId, cardIndex) {
      try {
        const isLiked = await window.toggleLike(postType, postId);
        const likeIcon = document.getElementById(`like-icon-${postType}-${cardIndex}`);
        const likeCount = document.getElementById(`like-count-${postType}-${cardIndex}`);
        
        if (likeIcon) {
          likeIcon.textContent = isLiked ? 'â¤ï¸' : 'ğŸ¤';
          likeIcon.style.color = isLiked ? '#e74c3c' : '#666';
        }
        
        if (likeCount) {
          const currentLikes = parseInt(likeCount.textContent) || 0;
          likeCount.textContent = isLiked ? currentLikes + 1 : Math.max(0, currentLikes - 1);
        }
        
        window.showSalonToast(isLiked ? 'ì¢‹ì•„ìš”! â¤ï¸' : 'ì¢‹ì•„ìš” ì·¨ì†Œ');
        
      } catch (error) {
        console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        window.showSalonToast('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };
    
    // ìŠ¤í† ë¦¬ ëŒ“ê¸€ í† ê¸€
    window.toggleStoryComments = async function(postType, postId, cardIndex) {
      const commentsSection = document.getElementById(`comments-${postType}-${cardIndex}`);
      if (!commentsSection) return;
      
      if (commentsSection.classList.contains('active')) {
        commentsSection.classList.remove('active');
      } else {
        commentsSection.classList.add('active');
        await window.loadStoryComments(postType, postId, cardIndex);
      }
    };
    
    // ìŠ¤í† ë¦¬ ëŒ“ê¸€ ë¡œë”©
    window.loadStoryComments = async function(postType, postId, cardIndex) {
      console.log('ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ ì‹œë„:', { postType, postId, cardIndex });
      const container = document.getElementById(`comment-list-${postType}-${cardIndex}`);
      if (!container) {
        console.error('ëŒ“ê¸€ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', `comment-list-${postType}-${cardIndex}`);
        return;
      }
      
      try {
        const comments = await window.getComments(postType, postId);
        console.log('ë¡œë“œëœ ëŒ“ê¸€:', comments);
        
        if (comments.length === 0) {
          container.innerHTML = '<div style="text-align:center;padding:20px;color:#666;">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
          return;
        }
        
        container.innerHTML = comments.map(comment => `
          <div class="story-comment">
            <div class="story-comment-header">
              <div class="story-comment-author">
                <div class="story-comment-avatar">ìµ</div>
                <div class="story-comment-info">
                  <div class="story-comment-name">ìµëª…</div>
                  <div class="story-comment-time">${window.formatTime(comment.timestamp)}</div>
                </div>
              </div>
            </div>
            <div class="story-comment-text">${comment.content}</div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('ëŒ“ê¸€ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="color:#f44336;padding:10px;">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
      }
    };
    
    // ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‘ì„±
    window.submitStoryComment = async function(postType, postId, cardIndex) {
      const input = document.getElementById(`comment-input-${postType}-${cardIndex}`);
      if (!input) {
        console.error('ëŒ“ê¸€ ì…ë ¥ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const content = input.value.trim();
      
      if (!content) {
        window.showSalonToast('ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      if (content.length > 200) {
        window.showSalonToast('ëŒ“ê¸€ì€ 200ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      try {
        const submitBtn = input.parentNode.querySelector('.story-comment-submit');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = 'ë“±ë¡ ì¤‘...';
        }
        
        // ëŒ“ê¸€ ì¶”ê°€ (í¬ì¸íŠ¸ëŠ” addComment ì•ˆì—ì„œ ì²˜ë¦¬)
        await window.addComment(postType, postId, content);
        
        input.value = '';
        window.showSalonToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! +30P ì ë¦½ ğŸ‰');
        
        // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const points = await window.getUserPoints();
        const pointDisplay = document.getElementById('habit-salon-my-point');
        if (pointDisplay) {
          pointDisplay.textContent = points;
        }
        
        // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        await window.loadStoryComments(postType, postId, cardIndex);
        
        // ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸
        const countElements = [
          document.getElementById(`comment-count-${postType}-${cardIndex}`),
          document.getElementById(`comment-header-count-${postType}-${cardIndex}`)
        ];
        
        countElements.forEach(countElement => {
          if (countElement) {
            const currentCount = parseInt(countElement.textContent) || 0;
            countElement.textContent = currentCount + 1;
            countElement.classList.add('comment-count-update');
            setTimeout(() => {
              countElement.classList.remove('comment-count-update');
            }, 300);
          }
        });
        
      } catch (error) {
        console.error('ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:', error);
        window.showSalonToast('ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        const submitBtn = input.parentNode.querySelector('.story-comment-submit');
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = 'ë“±ë¡';
        }
      }
    };
    
    // ìŠ¤í† ë¦¬ ì§ˆë¬¸ ë‹µë³€
    window.answerStoryQuestion = async function(questionId, optionIndex, cardIndex) {
      try {
        // ì¤‘ë³µ ë‹µë³€ ë°©ì§€
        const answerId = `answer_${questionId}_${window.getUserId()}`;
        const existingAnswer = localStorage.getItem(answerId);
        
        if (existingAnswer) {
          window.showSalonToast('ì´ë¯¸ ë‹µë³€í•œ ì§ˆë¬¸ì…ë‹ˆë‹¤.', 'warning');
          return;
        }
        
        // ë‹µë³€ ê¸°ë¡
        await addDoc(collection(db, 'question_answers'), {
          questionId: questionId,
          optionIndex: optionIndex,
          userId: window.getUserId(),
          timestamp: serverTimestamp()
        });
        
        // ì¤‘ë³µ ë‹µë³€ ë°©ì§€ìš© ë¡œì»¬ ì €ì¥
        localStorage.setItem(answerId, 'true');
        
        // í¬ì¸íŠ¸ ì§€ê¸‰
        await window.addUserPoints(30, 'question_answer', answerId);
        
        window.showSalonToast('ë‹µë³€ ì™„ë£Œ! +30P ì ë¦½ ğŸ‰');
        
        // í¬ì¸íŠ¸ í‘œì‹œ ì—…ë°ì´íŠ¸
        const points = await window.getUserPoints();
        const pointDisplay = document.getElementById('habit-salon-my-point');
        if (pointDisplay) {
          pointDisplay.textContent = points;
        }
        
        // ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
        const optionButtons = document.querySelectorAll(`#option-${cardIndex}-0, #option-${cardIndex}-1, #option-${cardIndex}-2, #option-${cardIndex}-3`);
        optionButtons.forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = '0.6';
          btn.style.cursor = 'not-allowed';
        });
        
        // ì„ íƒí•œ ì˜µì…˜ í•˜ì´ë¼ì´íŠ¸
        const selectedOption = document.getElementById(`option-${cardIndex}-${optionIndex}`);
        if (selectedOption) {
          selectedOption.style.background = 'rgba(255,255,255,0.3)';
          selectedOption.style.borderColor = 'rgba(255,255,255,0.6)';
        }
        
      } catch (error) {
        console.error('ì§ˆë¬¸ ë‹µë³€ ì˜¤ë¥˜:', error);
        window.showSalonToast('ë‹µë³€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };
    
    // ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ ì§€ì›
    let startX = 0;
    let isDragging = false;
    
    document.addEventListener('touchstart', function(e) {
      if (e.target.closest('.card-slider-container')) {
        startX = e.touches[0].clientX;
        isDragging = true;
      }
    });
    
    document.addEventListener('touchend', function(e) {
      if (!isDragging) return;
      isDragging = false;
      
      if (e.target.closest('.card-slider-container')) {
        const endX = e.changedTouches[0].clientX;
        const diffX = startX - endX;
        
        if (Math.abs(diffX) > 50) { // 50px ì´ìƒ ìŠ¤ì™€ì´í”„
          if (diffX > 0) {
            // ì™¼ìª½ ìŠ¤ì™€ì´í”„ (ë‹¤ìŒ ì¹´ë“œ)
            window.nextCard();
          } else {
            // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ (ì´ì „ ì¹´ë“œ)
            window.prevCard();
          }
        }
      }
    });
    
    console.log('ğŸ’¡ ì‹¤ì œ ìš´ì˜ ë°°í¬ ì‹œì—ëŠ” Firebase ì½˜ì†”ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.');
    console.log('ê°œë°œì ë„êµ¬ì—ì„œ í•„ìš” ì‹œ: addSampleData() ë˜ëŠ” fixMissingFields()');
    
    // ğŸš¨ ê¸´ê¸‰ ê°€ì´ë“œ ì¶œë ¥
    console.log('');
    console.log('ğŸš¨ Firestore ì¸ë±ìŠ¤ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ');
    console.log('=====================================');
    console.log('');
    console.log('1ï¸âƒ£ ì¦‰ì‹œ ì‹¤í–‰í•˜ì„¸ìš”:');
    console.log('  fixMissingFields()     // ê¸°ì¡´ ë¬¸ì„œ í•„ë“œ ë³´ì •');
    console.log('  addSampleData()        // ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€');
    console.log('');
    console.log('2ï¸âƒ£ ì¸ë±ìŠ¤ ìƒì„± ê°€ì´ë“œ:');
    console.log('  createIndexes()        // ìƒì„¸ ê°€ì´ë“œ ë³´ê¸°');
    console.log('');
    console.log('3ï¸âƒ£ ê°œë°œì ë„êµ¬ì—ì„œ ë‹¤ìŒ í•¨ìˆ˜ë“¤ ì‚¬ìš© ê°€ëŠ¥:');
    console.log('  habitSalonUtils.fixMissingFields()');
    console.log('  habitSalonUtils.addSampleData()');
    console.log('  habitSalonUtils.createIndexes()');
    console.log('');
    console.log('ğŸ“Œ ì£¼ì˜: ì¸ë±ìŠ¤ê°€ ì—†ìœ¼ë©´ ë¹ˆ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
    console.log('   í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ í•„í„°ë§ìœ¼ë¡œ ì„ì‹œ í•´ê²°ë¨');
    console.log('=====================================');
    console.log('');
    
    // ğŸ”„ ì˜¤í”„ë¼ì¸ ì•¡ì…˜ ë™ê¸°í™” í•¨ìˆ˜
    window.syncOfflineActions = async function() {
      try {
        const offlineActions = JSON.parse(localStorage.getItem('offlineActions') || '[]');
        
        if (offlineActions.length === 0) {
          console.log('ë™ê¸°í™”í•  ì˜¤í”„ë¼ì¸ ì•¡ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        if (!window.isOnline) {
          console.log('ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë™ê¸°í™”ë¥¼ ë‚˜ì¤‘ì— ì‹œë„í•©ë‹ˆë‹¤.');
          window.showSalonToast('ë„¤íŠ¸ì›Œí¬ ì—°ê²° í›„ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.', 'info');
          return;
        }
        
        console.log(`ğŸ”„ ${offlineActions.length}ê°œì˜ ì˜¤í”„ë¼ì¸ ì•¡ì…˜ ë™ê¸°í™” ì‹œì‘...`);
        let successCount = 0;
        let failCount = 0;
        
        for (const action of offlineActions) {
          try {
            if (action.type === 'addPoints') {
              // ì˜¤í”„ë¼ì¸ì—ì„œ ì¶”ê°€ëœ í¬ì¸íŠ¸ë¥¼ ì„œë²„ì— ë™ê¸°í™”
              await window.addUserPoints(action.pointsToAdd, action.source, action.actionId);
              successCount++;
            }
            // ë‹¤ë¥¸ ì•¡ì…˜ íƒ€ì…ë“¤ë„ ì—¬ê¸°ì— ì¶”ê°€ ê°€ëŠ¥
          } catch (error) {
            console.error('ì•¡ì…˜ ë™ê¸°í™” ì˜¤ë¥˜:', action, error);
            failCount++;
          }
        }
        
        // ì„±ê³µí•œ ì•¡ì…˜ë“¤ì€ íì—ì„œ ì œê±°
        if (successCount > 0) {
          localStorage.removeItem('offlineActions');
          console.log(`âœ… ${successCount}ê°œ ì•¡ì…˜ ë™ê¸°í™” ì™„ë£Œ`);
          window.showSalonToast(`${successCount}ê°œ ì˜¤í”„ë¼ì¸ ì•¡ì…˜ì´ ë™ê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ”„`, 'success');
        }
        
        if (failCount > 0) {
          console.log(`âŒ ${failCount}ê°œ ì•¡ì…˜ ë™ê¸°í™” ì‹¤íŒ¨`);
          window.showSalonToast(`${failCount}ê°œ ì•¡ì…˜ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.`, 'warning');
        }
        
      } catch (error) {
        console.error('ì˜¤í”„ë¼ì¸ ì•¡ì…˜ ë™ê¸°í™” ì˜¤ë¥˜:', error);
        window.showSalonToast('ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };
    
    // ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ ìë™ ë™ê¸°í™” (ê¸°ì¡´ online ì´ë²¤íŠ¸ì— ì¶”ê°€)
    const originalOnlineHandler = window.addEventListener('online', () => {
      console.log('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨ - Firestore ì¬ì—°ê²° ì‹œë„');
      window.isOnline = true;
      window.showSalonToast('ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŒ', 'success');
      enableNetwork(db).catch(error => {
        console.log('Firestore ë„¤íŠ¸ì›Œí¬ ì¬í™œì„±í™” ì˜¤ë¥˜:', error);
      });
      
      // ìë™ ë™ê¸°í™” ì¶”ê°€
      setTimeout(async () => {
        try {
          await window.syncOfflineActions();
          // ìºì‹œ ìƒˆë¡œê³ ì¹¨ë„ ì‹œë„
          const habitSalonMain = document.getElementById('habit-salon-main');
          if (habitSalonMain && habitSalonMain.style.display !== 'none') {
            console.log('ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ - ìŠµê´€ì‚´ë¡± ë°ì´í„° ìƒˆë¡œê³ ì¹¨');
            // í˜„ì¬ í™œì„± ì„¹ì…˜ ìƒˆë¡œê³ ì¹¨
            const activeSections = ['brand', 'question', 'free'];
            for (const section of activeSections) {
              const sectionElement = document.getElementById(`habit-salon-${section}`);
              if (sectionElement && sectionElement.style.display !== 'none') {
                await window.showHabitSalonSection(section);
                break;
              }
            }
          }
        } catch (error) {
          console.error('ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ í›„ ë™ê¸°í™” ì˜¤ë¥˜:', error);
        }
      }, 2000); // 2ì´ˆ í›„ ë™ê¸°í™” ì‹œë„
    });

    // í˜ì´ì§€ ë¡œë“œ í›„ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // ìŠµê´€ì‚´ë¡± ì§„ì… ë²„íŠ¼ ì´ë²¤íŠ¸
      const enterBtn = document.getElementById('habit-salon-enter-btn');
      if (enterBtn) {
        enterBtn.addEventListener('click', function() {
          document.getElementById('main-section').style.display = 'none';
          document.getElementById('habit-salon-main').style.display = 'block';
          window.initHabitSalon();
        });
      }
      
      // í¬ì¸íŠ¸ ë™ê¸°í™” ë° êµí™˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      window.getUserPoints().then(points => {
        const pointElements = document.querySelectorAll('#points, #habit-salon-my-point');
        pointElements.forEach(el => {
          if (el) el.textContent = points;
        });
        
        // êµí™˜ ë²„íŠ¼ í™œì„±í™” ì¡°ê±´ í™•ì¸
        const exchangeButton = document.getElementById('exchange-button');
        const pointsInsufficient = document.getElementById('points-insufficient');
        
        if (exchangeButton && pointsInsufficient) {
          if (points >= 5000) {
            exchangeButton.style.display = 'block';
            pointsInsufficient.style.display = 'none';
          } else {
            exchangeButton.style.display = 'none';
            pointsInsufficient.style.display = 'block';
          }
        }
      }).catch(error => {
        console.error('í¬ì¸íŠ¸ ë™ê¸°í™” ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ ë¡œì»¬ í¬ì¸íŠ¸ ì‚¬ìš©
        const localPoints = parseInt(localStorage.getItem('points') || '0');
        const pointElements = document.querySelectorAll('#points, #habit-salon-my-point');
        pointElements.forEach(el => {
          if (el) el.textContent = localPoints;
        });
      });
      
      // ğŸš¨ ìë™ ë°ì´í„° ìƒíƒœ ì²´í¬ ë° ì´ˆê¸°í™”
      setTimeout(async () => {
        try {
          console.log('ğŸ” ë°ì´í„° ìƒíƒœ ìë™ ì²´í¬ ì‹œì‘...');
          
          // Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
          const testQuery = query(collection(db, 'brand_posts'), orderBy('timestamp', 'desc'));
          const testSnapshot = await getDocs(testQuery);
          
          let needsSampleData = false;
          let needsFieldFix = false;
          
          if (testSnapshot.empty) {
            console.log('âŒ brand_posts ì»¬ë ‰ì…˜ì´ ë¹„ì–´ìˆìŒ - ìƒ˜í”Œ ë°ì´í„° í•„ìš”');
            needsSampleData = true;
          } else {
            console.log(`âœ… brand_posts ${testSnapshot.size}ê°œ ë¬¸ì„œ ë°œê²¬`);
            
            // í•„ë“œ ëˆ„ë½ ì²´í¬
            const today = new Date().toISOString().split('T')[0];
            let validPosts = 0;
            
            testSnapshot.forEach((doc) => {
              const data = doc.data();
              if (data.isPublished === true && data.date === today && data.timestamp) {
                validPosts++;
              }
            });
            
            console.log(`ğŸ“Š ì˜¤ëŠ˜ ë‚ ì§œ & ìœ íš¨í•œ ê²Œì‹œê¸€: ${validPosts}ê°œ`);
            
            if (validPosts === 0) {
              console.log('âš ï¸ ìœ íš¨í•œ ê²Œì‹œê¸€ì´ ì—†ìŒ - í•„ë“œ ë³´ì • ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„° í•„ìš”');
              needsFieldFix = true;
              needsSampleData = true;
            }
          }
          
          // ìë™ ì´ˆê¸°í™” ì‹¤í–‰
          if (needsSampleData) {
            console.log('ğŸš€ ìë™ ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì‹¤í–‰...');
            await window.addSampleData();
            await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°
          }
          
          if (needsFieldFix) {
            console.log('ğŸš€ ìë™ í•„ë“œ ë³´ì • ì‹¤í–‰...');
            await window.fixMissingFields();
          }
          
          console.log('âœ… ìë™ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ!');
          
        } catch (error) {
          console.error('âŒ ìë™ ë°ì´í„° ì²´í¬ ì˜¤ë¥˜:', error);
          console.log('ğŸ’¡ ìˆ˜ë™ìœ¼ë¡œ "ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.');
          window.showSalonToast('ë°ì´í„° ì´ˆê¸°í™”ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë©”ì¸ í™”ë©´ì˜ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.', 'warning');
        }
      }, 3000); // 3ì´ˆ í›„ ìë™ ì²´í¬ ì‹¤í–‰
    });

    // ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ í•¨ìˆ˜
    window.addSampleData = async function() {
      try {
        console.log('ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì‹œì‘...');
        
        const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        
        // ë¸Œëœë“œ ê²Œì‹œê¸€ ìƒ˜í”Œ
        await addDoc(collection(db, 'brand_posts'), {
          title: 'ëŠ˜ë´„ê³¼ í•¨ê»˜í•˜ëŠ” ê±´ê°•í•œ ìŠµê´€',
          content: 'ì•ˆë…•í•˜ì„¸ìš”, ëŠ˜ë´„íŒ€ì…ë‹ˆë‹¤! ê±´ê°•í•œ ìŠµê´€ìœ¼ë¡œ ë” ë‚˜ì€ ë‚´ì¼ì„ ë§Œë“¤ì–´ê°€ëŠ” ì—¬ì •ì— í•¨ê»˜í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ì‘ì€ ë³€í™”ê°€ í° ì°¨ì´ë¥¼ ë§Œë“ ë‹¤ëŠ” ë¯¿ìŒìœ¼ë¡œ, ì—¬ëŸ¬ë¶„ì˜ ê±´ê°•í•œ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ì‘ì›í•©ë‹ˆë‹¤.',
          author: 'ëŠ˜ë´„íŒ€',
          timestamp: serverTimestamp(),
          likes: 0,
          commentCount: 0,
          imageUrl: null,
          isPublished: true,
          date: today
        });
        
        await addDoc(collection(db, 'brand_posts'), {
          title: 'ì‘ì€ ìŠµê´€, í° ë³€í™”',
          content: 'ë§¤ì¼ ì•„ì¹¨ ë¬¼ í•œ ì”ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” í•˜ë£¨, ê³„ë‹¨ í•œ ì¸µ ë” ì˜¬ë¼ê°€ê¸°, ê°ì‚¬ ì¸ì‚¬ í•œ ë²ˆ ë” í•˜ê¸°. ì´ëŸ° ì‘ì€ ìŠµê´€ë“¤ì´ ëª¨ì—¬ ìš°ë¦¬ì˜ ê±´ê°•í•œ ë‚´ì¼ì„ ë§Œë“¤ì–´ê°‘ë‹ˆë‹¤. ëŠ˜ë´„ê³¼ í•¨ê»˜ ì˜¤ëŠ˜ë„ ì‘ì€ ì‹¤ì²œì„ ì‹œì‘í•´ë³´ì„¸ìš”!',
          author: 'ëŠ˜ë´„íŒ€',
          timestamp: serverTimestamp(),
          likes: 0,
          commentCount: 0,
          imageUrl: null,
          isPublished: true,
          date: today
        });
        
        // ê±´ê°• ì§ˆë¬¸ ìƒ˜í”Œ
        await addDoc(collection(db, 'health_questions'), {
          question: 'ì˜¤ëŠ˜ ë¬¼ì„ ì¶©ë¶„íˆ ë§ˆì…¨ë‚˜ìš”?',
          options: [
            'ë„¤, 2L ì´ìƒ ë§ˆì…¨ì–´ìš” ğŸ’§',
            'ì ë‹¹íˆ ë§ˆì…¨ì–´ìš” ğŸ¥¤',
            'ë§ì´ ë¶€ì¡±í•´ìš” ğŸ˜…',
            'ë¬¼ ë§ˆì‹œëŠ” ê±¸ ê¹œë¹¡í–ˆì–´ìš” ğŸ’¦'
          ],
          timestamp: serverTimestamp(),
          responses: 0,
          isPublished: true,
          date: today
        });
        
        await addDoc(collection(db, 'health_questions'), {
          question: 'ì˜¤ëŠ˜ ìŠ¤íŠ¸ë ˆì¹­ì´ë‚˜ ìš´ë™ì„ í•˜ì…¨ë‚˜ìš”?',
          options: [
            '30ë¶„ ì´ìƒ ìš´ë™í–ˆì–´ìš” ğŸ’ª',
            'ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ì„ í–ˆì–´ìš” ğŸ§˜â€â™€ï¸',
            'ê³„ë‹¨ ì˜¤ë¥´ê¸° ì •ë„ë§Œ í–ˆì–´ìš” ğŸš¶â€â™‚ï¸',
            'ê±°ì˜ ì›€ì§ì´ì§€ ì•Šì•˜ì–´ìš” ğŸ˜´'
          ],
          timestamp: serverTimestamp(),
          responses: 0,
          isPublished: true,
          date: today
        });
        
        await addDoc(collection(db, 'health_questions'), {
          question: 'ì˜¤ëŠ˜ í•˜ë£¨ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ëŠ” ì–´ë– ì…¨ë‚˜ìš”?',
          options: [
            'ëª…ìƒì´ë‚˜ íœ´ì‹ìœ¼ë¡œ ì˜ ê´€ë¦¬í–ˆì–´ìš” ğŸ§˜â€â™€ï¸',
            'ì ë‹¹íˆ ê´€ë¦¬í–ˆì–´ìš” ğŸ˜Œ',
            'ì¡°ê¸ˆ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë§ì•˜ì–´ìš” ğŸ˜°',
            'ë§¤ìš° ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹¬í–ˆì–´ìš” ğŸ˜µ'
          ],
          timestamp: serverTimestamp(),
          responses: 0,
          isPublished: true,
          date: today
        });
        
        console.log('ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì™„ë£Œ!');
        window.showSalonToast('ìƒ˜í”Œ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
        
      } catch (error) {
        console.error('ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì˜¤ë¥˜:', error);
        window.showSalonToast('ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    };
    
    // ì½˜ì†”ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    window.habitSalonUtils = {
      addSampleData: window.addSampleData,
      getUserPoints: window.getUserPoints,
      addUserPoints: window.addUserPoints,
      loadBrandPosts: window.loadBrandPosts,
      loadHealthQuestions: window.loadHealthQuestions,
      loadUserPosts: window.loadUserPosts,
      fixMissingFields: window.fixMissingFields,
      createIndexes: window.createIndexes,
      syncOfflineActions: window.syncOfflineActions
    };
    
    console.log('ğŸš¨ Firestore ì—°ê²° ë¬¸ì œ ì™„ì „ í•´ê²°!');
    console.log('=====================================');
    console.log('');
    console.log('âœ… ì ìš©ëœ í•´ê²°ì±…:');
    console.log('  - ì˜¤í”„ë¼ì¸ ì§€ì› í™œì„±í™” âœ“');
    console.log('  - ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ìë™ ê°ì§€ âœ“');
    console.log('  - ìºì‹œ ì‹œìŠ¤í…œ êµ¬í˜„ âœ“');
    console.log('  - ê°•í™”ëœ ì˜¤ë¥˜ ì²˜ë¦¬ âœ“');
    console.log('  - ìë™ ë™ê¸°í™” ì‹œìŠ¤í…œ âœ“');
    console.log('');
    console.log('ğŸ”§ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜:');
    console.log('  fixMissingFields()     // ê¸°ì¡´ ë¬¸ì„œ í•„ë“œ ë³´ì •');
    console.log('  addSampleData()        // ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€');
    console.log('  syncOfflineActions()   // ì˜¤í”„ë¼ì¸ ì•¡ì…˜ ë™ê¸°í™”');
    console.log('');
    console.log('ğŸ“Š ì¸ë±ìŠ¤ ìƒì„± ê°€ì´ë“œ:');
    console.log('  createIndexes()        // ìƒì„¸ ê°€ì´ë“œ ë³´ê¸°');
    console.log('');
    console.log('ğŸ”„ ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í•¨ìˆ˜:');
    console.log('  habitSalonUtils.fixMissingFields()');
    console.log('  habitSalonUtils.addSampleData()');
    console.log('  habitSalonUtils.syncOfflineActions()');
    console.log('  habitSalonUtils.createIndexes()');
    console.log('');
    console.log('ğŸ’¡ í˜„ì¬ ìƒíƒœ:');
    console.log('  ë„¤íŠ¸ì›Œí¬:', window.isOnline ? 'ğŸŸ¢ ì˜¨ë¼ì¸' : 'ğŸ”´ ì˜¤í”„ë¼ì¸');
    console.log('  Firestore: ì˜¤í”„ë¼ì¸ ì§€ì› í™œì„±í™”ë¨ âœ“');
    console.log('=====================================');
    console.log('');
    
    // ì „ì²´ í™”ë©´ ë¸Œëœë“œ ì´ì•¼ê¸° í˜ì´ì§€ í•¨ìˆ˜ë“¤
    window.openBrandStoryPage = async function() {
      try {
        // ë¡œë”© í‘œì‹œ
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.add('active');
        
        // ë¸Œëœë“œ ë°ì´í„° ë¡œë”©
        const posts = await window.loadBrandPosts();
        
        if (posts.length === 0) {
          window.showSalonToast('ë¸Œëœë“œ ì´ì•¼ê¸°ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
          overlay.classList.remove('active');
          return;
        }
        
        // ì¹´ë“œ ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
        currentCards = posts;
        currentSection = 'brand';
        currentCardIndex = 0;
        
        // ë¸Œëœë“œ ìŠ¤í† ë¦¬ ì½˜í…ì¸  ìƒì„±
        const container = document.getElementById('brand-story-content');
        container.innerHTML = `
          <div class="card-slider-container">
            <div class="card-slider" id="brand-fullscreen-slider">
              ${posts.map((post, index) => `
                <div class="story-card" data-index="${index}">
                  ${post.imageUrl ? `<img src="${post.imageUrl}" alt="ë¸Œëœë“œ ì´ë¯¸ì§€" class="story-card-image">` : 
                    '<div class="story-card-image" style="display:flex;align-items:center;justify-content:center;font-size:64px;background:linear-gradient(135deg,#356c55,#4a7c59);">ğŸŒ¿</div>'}
                  <div class="story-card-content">
                    <h3 class="story-card-title">${post.title || 'ëŠ˜ë´„ ë¸Œëœë“œ ì´ì•¼ê¸°'}</h3>
                    <p class="story-card-text">${post.content}</p>
                    <div class="story-card-meta">
                      <div class="story-card-author">
                        <div class="story-card-avatar">ëŠ˜</div>
                        <div class="story-card-author-info">
                          <div class="story-card-author-name">${post.author || 'ëŠ˜ë´„íŒ€'}</div>
                          <div class="story-card-time">${window.formatTime(post.timestamp)}</div>
                        </div>
                      </div>
                      <div class="story-card-actions">
                        <button class="story-action-btn" onclick="window.toggleStoryLike('brand', '${post.id}', ${index})">
                          <span id="like-icon-brand-${index}">â¤ï¸</span>
                          <span id="like-count-brand-${index}">${post.likes || 0}</span>
                        </button>
                        <button class="story-action-btn comment-btn" onclick="window.toggleStoryComments('brand', '${post.id}', ${index})">
                          <span>ğŸ’¬</span>
                          <span id="comment-count-brand-${index}">${post.commentCount || 0}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="story-comments-section active" id="comments-brand-${index}">
                    <div class="story-comments-header">
                      ëŒ“ê¸€ <span id="comment-header-count-brand-${index}">${post.commentCount || 0}</span>ê°œ
                    </div>
                    <div class="story-comments-list" id="comment-list-brand-${index}">
                      <!-- ëŒ“ê¸€ ëª©ë¡ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="story-comment-input">
                      <div class="story-comment-form">
                        <textarea id="comment-input-brand-${index}" class="story-comment-textarea" 
                                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... (+30P)" maxlength="200"></textarea>
                        <button onclick="window.submitStoryComment('brand', '${post.id}', ${index})" 
                                class="story-comment-submit">ë“±ë¡</button>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            ${posts.length > 1 ? `
              <button class="card-nav prev" onclick="window.prevCard()" id="prev-btn">â€¹</button>
              <button class="card-nav next" onclick="window.nextCard()" id="next-btn">â€º</button>
            ` : ''}
          </div>
          ${posts.length > 1 ? `
            <div class="card-indicators">
              ${posts.map((_, index) => `
                <div class="card-indicator ${index === 0 ? 'active' : ''}" 
                     onclick="window.goToCard(${index})" data-index="${index}"></div>
              `).join('')}
            </div>
          ` : ''}
        `;
        
        // í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
          overlay.classList.remove('active');
          const fullscreenPage = document.getElementById('brand-story-fullscreen');
          fullscreenPage.classList.add('active');
          
          // ì¹´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì—…ë°ì´íŠ¸
          window.updateCardNavigation();
          
          // ë°”ë”” ìŠ¤í¬ë¡¤ ë°©ì§€
          document.body.style.overflow = 'hidden';
        }, 200);
        
      } catch (error) {
        console.error('ë¸Œëœë“œ ìŠ¤í† ë¦¬ í˜ì´ì§€ ì—´ê¸° ì˜¤ë¥˜:', error);
        window.showSalonToast('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.remove('active');
      }
    };
    
    window.closeBrandStoryPage = function() {
      const fullscreenPage = document.getElementById('brand-story-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      
      // í˜ì´ì§€ ë‹«ê¸° ì• ë‹ˆë©”ì´ì…˜
      overlay.classList.add('active');
      fullscreenPage.classList.remove('active');
      
      setTimeout(() => {
        overlay.classList.remove('active');
        // ë°”ë”” ìŠ¤í¬ë¡¤ ë³µì›
        document.body.style.overflow = 'auto';
      }, 300);
    };
    
    // ESC í‚¤ë¡œ ì „ì²´ í™”ë©´ í˜ì´ì§€ ë‹«ê¸°
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const fullscreenPage = document.getElementById('brand-story-fullscreen');
        if (fullscreenPage.classList.contains('active')) {
          window.closeBrandStoryPage();
        }
      }
    });
    
    // ì¹´ë“œ ìŠ¬ë¼ì´ë” ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤

    // ì „ì²´ í™”ë©´ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ í˜ì´ì§€
    window.openQuestionPage = async function() {
      try {
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.add('active');
        const questions = await window.loadHealthQuestions();
        if (questions.length === 0) {
          window.showSalonToast('ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
          overlay.classList.remove('active');
          return;
        }
        currentCards = questions;
        currentSection = 'question';
        currentCardIndex = 0;
        const container = document.getElementById('question-content');
        container.innerHTML = `
          <div class="card-slider-container">
            <div class="card-slider" id="question-fullscreen-slider">
              ${questions.map((question, index) => `
                <div class="story-card question-card" data-index="${index}">
                  <div class="story-card-content">
                    <h3 class="story-card-title">ğŸ“ ${question.question}</h3>
                    <div class="question-options">
                      ${question.options ? question.options.map((option, optionIndex) => `
                        <button class="question-option" 
                                onclick="window.answerStoryQuestion('${question.id}', ${optionIndex}, ${index})"
                                id="option-${index}-${optionIndex}">
                          ${option}
                        </button>
                      `).join('') : ''}
                    </div>
                    <div class="question-reward">ğŸ’¡ ë‹µë³€í•˜ë©´ 30Pê°€ ì ë¦½ë©ë‹ˆë‹¤!</div>
                  </div>
                  <div class="story-comments-section active" id="comments-question-${index}">
                    <div class="story-comments-header">
                      ëŒ“ê¸€ <span id="comment-header-count-question-${index}">${question.commentCount || 0}</span>ê°œ
                    </div>
                    <div class="story-comments-list" id="comment-list-question-${index}"></div>
                    <div class="story-comment-input">
                      <div class="story-comment-form">
                        <textarea id="comment-input-question-${index}" class="story-comment-textarea" 
                                  placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”... (+30P)" maxlength="200"></textarea>
                        <button onclick="window.submitStoryComment('question', '${question.id}', ${index})" 
                                class="story-comment-submit">ë“±ë¡</button>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            ${questions.length > 1 ? `
              <button class="card-nav prev" onclick="window.prevCard()" id="prev-btn">â€¹</button>
              <button class="card-nav next" onclick="window.nextCard()" id="next-btn">â€º</button>
            ` : ''}
          </div>
          ${questions.length > 1 ? `
            <div class="card-indicators">
              ${questions.map((_, index) => `
                <div class="card-indicator ${index === 0 ? 'active' : ''}" 
                     onclick="window.goToCard(${index})" data-index="${index}"></div>
              `).join('')}
            </div>
          ` : ''}
        `;
        setTimeout(() => {
          overlay.classList.remove('active');
          const fullscreenPage = document.getElementById('question-fullscreen');
          fullscreenPage.classList.add('active');
          window.updateCardNavigation();
          document.body.style.overflow = 'hidden';
        }, 200);
      } catch (error) {
        console.error('ì§ˆë¬¸ ì „ì²´í™”ë©´ í˜ì´ì§€ ì—´ê¸° ì˜¤ë¥˜:', error);
        window.showSalonToast('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.remove('active');
      }
    };
    window.closeQuestionPage = function() {
      const fullscreenPage = document.getElementById('question-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      overlay.classList.add('active');
      fullscreenPage.classList.remove('active');
      setTimeout(() => {
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      }, 300);
    };

    // ì „ì²´ í™”ë©´ ììœ ê¸€(ê±´ê°• í•œë§ˆë‹¹) í˜ì´ì§€
    window.openFreePage = async function() {
      try {
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.add('active');
        const fullscreenPage = document.getElementById('free-fullscreen');
        const container = document.getElementById('free-content');
        if (!container) return;
        
        let posts = await window.loadUserPosts();
        // ì •ë ¬
        if (window.freeFeedSort === 'popular') {
          posts = posts.slice().sort((a, b) => ((b.likes||0)+(b.commentCount||0)) - ((a.likes||0)+(a.commentCount||0)) || (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
        } else {
          posts = posts.slice().sort((a, b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
        }

        // ì „ì²´í™”ë©´ HTML ë Œë”ë§
        let html = `
          <div class="free-feed-tabs" style="display:flex;gap:8px;justify-content:flex-end;margin-bottom:18px;">
            <button id="free-tab-latest" class="feed-sort-btn${window.freeFeedSort==='latest'?' active':''}">ìµœì‹ ìˆœ</button>
            <button id="free-tab-popular" class="feed-sort-btn${window.freeFeedSort==='popular'?' active':''}">ì¸ê¸°ìˆœ</button>
          </div>
          <div class="free-feed-list">
            ${posts.length === 0 ? 
              '<div style="text-align:center;padding:40px;color:#666;">ì²« ë²ˆì§¸ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>' :
              posts.map((post, idx) => {
                const isMine = post.userId === window.getUserId();
                const preview = post.content.length > 60 ? post.content.slice(0, 60) + '...' : post.content;
                return `
                  <div class="feed-card" style="margin-bottom:22px;box-shadow:0 2px 10px rgba(53,108,85,0.08);border-radius:18px;background:#fff;overflow:hidden;transition:box-shadow 0.2s;">
                    <div class="feed-card-content" style="padding:20px;">
                      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                        <div class="feed-card-avatar" style="width:32px;height:32px;background:#e0ede3;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#356c55;">ìµ</div>
                        <div style="flex:1;">
                          <span style="font-weight:600;color:#356c55;">ìµëª…</span>
                          <span style="font-size:13px;color:#999;margin-left:8px;">${window.formatTime(post.timestamp)}</span>
                          ${isMine ? '<span style="background:#e0ede3;color:#356c55;font-size:12px;padding:2px 8px;border-radius:8px;margin-left:8px;">ë‚´ê°€ ì“´ ê¸€</span>' : ''}
                        </div>
                      </div>
                      <div class="feed-card-title" style="font-size:16px;font-weight:600;margin-bottom:6px;">${preview}</div>
                      ${post.content.length > 60 ? `<button class="feed-more-btn" style="font-size:13px;color:#388e3c;background:none;border:none;cursor:pointer;" onclick="window.showFullPost(${idx})">ë”ë³´ê¸°</button>` : ''}
                      <div class="feed-card-actions" style="display:flex;gap:16px;align-items:center;justify-content:flex-end;margin-top:12px;">
                        <button class="story-action-btn" style="color:#e74c3c;display:flex;align-items:center;gap:4px;background:none;border:none;cursor:pointer;font-size:15px;" onclick="window.toggleStoryLike('free', '${post.id}', ${idx})">
                          <span id="like-icon-free-${idx}">${post.isLiked?'â¤ï¸':'ğŸ¤'}</span>
                          <span id="like-count-free-${idx}">${post.likes || 0}</span>
                        </button>
                        <button class="story-action-btn comment-btn" style="color:#356c55;display:flex;align-items:center;gap:4px;background:none;border:none;cursor:pointer;font-size:15px;" onclick="window.showFullPost(${idx},true)">
                          <span>ğŸ’¬</span>
                          <span id="comment-count-free-${idx}">${post.commentCount || 0}</span>
                        </button>
                        ${isMine ? `<button class="story-action-btn" style="color:#888;font-size:13px;background:none;border:none;cursor:pointer;" onclick="window.editMyPost('${post.id}')">ìˆ˜ì •</button><button class="story-action-btn" style="color:#888;font-size:13px;background:none;border:none;cursor:pointer;" onclick="window.deleteMyPost('${post.id}')">ì‚­ì œ</button>` : ''}
                      </div>
                      <div class="feed-card-comments-preview" style="margin-top:10px;">
                        ${(Array.isArray(post.commentsPreview) && post.commentsPreview.length > 0) ? post.commentsPreview.slice(-2).map(c => `
                          <div class="feed-comment-preview" style="font-size:13px;color:#666;margin-bottom:2px;"><span class="feed-comment-author" style="color:#356c55;font-weight:600;">${c.author}</span>: <span class="feed-comment-text">${c.content.length>30?c.content.slice(0,30)+'...':c.content}</span></div>
                        `).join('') : ''}
                        ${(post.commentCount||0)>2 ? `<button class="feed-more-comments-btn" style="font-size:12px;color:#388e3c;background:none;border:none;cursor:pointer;" onclick="window.showFullPost(${idx},true)">ëŒ“ê¸€ ì „ì²´ë³´ê¸°</button>` : ''}
                      </div>
                    </div>
                  </div>
                `;
              }).join('')
            }
          </div>
          <button class="floating-write-btn" id="floating-write-btn" title="ê¸€ì“°ê¸°" onclick="window.openWriteModal()">+</button>
        `;
        container.innerHTML = html;

        // ê¸€ì“°ê¸° ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ ì •ì˜
        window.openWriteModal = function() {
          const writeFullscreen = document.getElementById('free-write-fullscreen');
          const overlay = document.getElementById('page-transition-overlay');
          
          if (writeFullscreen && overlay) {
            overlay.classList.add('active');
            setTimeout(() => {
              overlay.classList.remove('active');
              writeFullscreen.classList.add('active');
              document.body.style.overflow = 'hidden';
              // ìë™ìœ¼ë¡œ textareaì— í¬ì»¤ìŠ¤
              const textarea = document.getElementById('habit-salon-free-content');
              if (textarea) textarea.focus();
            }, 200);
          }
        };

        // íƒ­ ì´ë²¤íŠ¸
        document.getElementById('free-tab-latest').onclick = () => {
          window.freeFeedSort = 'latest';
          window.openFreePage();
        };
        document.getElementById('free-tab-popular').onclick = () => {
          window.freeFeedSort = 'popular';
          window.openFreePage();
        };

        // í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
          overlay.classList.remove('active');
          fullscreenPage.classList.add('active');
          document.body.style.overflow = 'hidden';
        }, 200);
      } catch (error) {
        console.error('ììœ ê¸€ ì „ì²´í™”ë©´ í˜ì´ì§€ ì—´ê¸° ì˜¤ë¥˜:', error);
        window.showSalonToast('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.remove('active');
      }
    };

    window.closeFreePage = function() {
      const fullscreenPage = document.getElementById('free-fullscreen');
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      
      // ê¸€ì“°ê¸° ëª¨ë‹¬ì´ ì—´ë ¤ìˆë‹¤ë©´ ë¨¼ì € ë‹«ê¸°
      if (writeFullscreen && writeFullscreen.classList.contains('active')) {
        window.closeWriteModal();
        return;
      }

      // í”¼ë“œ í˜ì´ì§€ ë‹«ê¸°
      if (fullscreenPage && overlay) {
        overlay.classList.add('active');
        fullscreenPage.classList.remove('active');
        setTimeout(() => {
          overlay.classList.remove('active');
          document.body.style.overflow = 'auto';
        }, 300);
      }
    };

    // ESC í‚¤ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const writeFullscreen = document.getElementById('free-write-fullscreen');
        const fullscreenPage = document.getElementById('free-fullscreen');
        
        // ê¸€ì“°ê¸° ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë¨¼ì € ë‹«ê¸°
        if (writeFullscreen && writeFullscreen.classList.contains('active')) {
          window.closeWriteModal();
          return;
        }
        
        // í”¼ë“œ í˜ì´ì§€ê°€ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
        if (fullscreenPage && fullscreenPage.classList.contains('active')) {
          window.closeFreePage();
        }
      }
    });

    // 1. ì •ë ¬ ìƒíƒœ ë³€ìˆ˜ ë° í† ê¸€ ì´ë²¤íŠ¸
    window.freeFeedSort = 'latest'; // ê¸°ë³¸ê°’ ìµœì‹ ìˆœ

    document.addEventListener('DOMContentLoaded', function() {
      // ...ê¸°ì¡´ ì½”ë“œ...
      // ììœ ê¸€ í”¼ë“œ ì •ë ¬ í† ê¸€ ì´ë²¤íŠ¸
      const latestBtn = document.getElementById('sort-latest-btn');
      const popularBtn = document.getElementById('sort-popular-btn');
      const floatingWriteBtn = document.getElementById('floating-write-btn');
      
      if (latestBtn && popularBtn) {
        latestBtn.addEventListener('click', function() {
          latestBtn.classList.add('active');
          popularBtn.classList.remove('active');
          window.freeFeedSort = 'latest';
          window.loadFreeSection();
        });
        
        popularBtn.addEventListener('click', function() {
          popularBtn.classList.add('active');
          latestBtn.classList.remove('active');
          window.freeFeedSort = 'popular';
          window.loadFreeSection();
        });
      }

      // í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      if (floatingWriteBtn) {
        floatingWriteBtn.addEventListener('click', function() {
          const writeFullscreen = document.getElementById('free-write-fullscreen');
          const overlay = document.getElementById('page-transition-overlay');
          
          overlay.classList.add('active');
          setTimeout(() => {
            overlay.classList.remove('active');
            writeFullscreen.classList.add('active');
            document.body.style.overflow = 'hidden';
            // ìë™ìœ¼ë¡œ textareaì— í¬ì»¤ìŠ¤
            const textarea = document.getElementById('habit-salon-free-content');
            if (textarea) textarea.focus();
          }, 200);
        });
      }
    });

    // 2. loadFreeSection í•¨ìˆ˜ ê°œì„ 
    window.loadFreeSection = async function() {
      const container = document.getElementById('habit-salon-free-list');
      if (!container) return;
      
      container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ë¡œë”© ì¤‘...</div>';
      
      try {
        let posts = await window.loadUserPosts();
        // ì •ë ¬
        if (window.freeFeedSort === 'popular') {
          posts = posts.slice().sort((a, b) => ((b.likes||0)+(b.commentCount||0)) - ((a.likes||0)+(a.commentCount||0)) || (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
        } else {
          posts = posts.slice().sort((a, b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
        }
        if (posts.length === 0) {
          container.innerHTML = '<div style="text-align:center;padding:40px;color:#666;">ì²« ë²ˆì§¸ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
          return;
        }
        window.currentCards = posts;
        window.currentSection = 'free';
        window.currentCardIndex = 0;
        // 3. ì¹´ë“œí˜• í”¼ë“œ ë Œë”ë§(ë¯¸ë¦¬ë³´ê¸°/ë”ë³´ê¸°/ê³µê°/ëŒ“ê¸€/ëŒ“ê¸€ ë¯¸ë¦¬ë³´ê¸°)
        container.innerHTML = `
          <div class="card-feed-list">
            ${posts.map((post, index) => {
              // ë³¸ë¬¸ ë¯¸ë¦¬ë³´ê¸°(2~3ì¤„, 60ì ê¸°ì¤€)
              const preview = post.content.length > 60 ? post.content.slice(0, 60) + '...' : post.content;
              // ë”ë³´ê¸° ë²„íŠ¼ í•„ìš” ì—¬ë¶€
              const showMore = post.content.length > 60;
              // ëŒ“ê¸€ ë¯¸ë¦¬ë³´ê¸°(ìµœì‹  1~2ê°œ)
              let commentPreviewHtml = '';
              if (Array.isArray(post.commentsPreview) && post.commentsPreview.length > 0) {
                commentPreviewHtml = post.commentsPreview.slice(-2).map(c => `
                  <div class="feed-comment-preview">
                    <span class="feed-comment-author">${c.author}</span>: <span class="feed-comment-text">${c.content.length>30?c.content.slice(0,30)+'...':c.content}</span>
                  </div>
                `).join('');
              }
              return `
                <div class="feed-card" data-index="${index}">
                  <div class="feed-card-content">
                    <div class="feed-card-meta" style="margin-bottom:8px;">
                      <div class="feed-card-author">
                        <div class="feed-card-avatar">ìµ</div>
                        <div class="feed-card-author-info">
                          <div class="feed-card-author-name">ìµëª…</div>
                          <div class="feed-card-time">${window.formatTime(post.timestamp)}</div>
                        </div>
                      </div>
                    </div>
                    <div class="feed-card-title" style="font-size:16px;font-weight:600;margin-bottom:6px;">${preview}</div>
                    ${showMore ? `<button class="feed-more-btn" onclick="window.showFullPost(${index})">ë”ë³´ê¸°</button>` : ''}
                    <div class="feed-card-actions" style="justify-content:flex-end;margin-top:12px;">
                      <button class="story-action-btn" onclick="window.toggleStoryLike('free', '${post.id}', ${index})">
                        <span id="like-icon-free-${index}">${post.isLiked?'â¤ï¸':'ğŸ¤'}</span>
                        <span id="like-count-free-${index}">${post.likes || 0}</span>
                      </button>
                      <button class="story-action-btn comment-btn" onclick="window.showFullPost(${index},true)">
                        <span>ğŸ’¬</span>
                        <span id="comment-count-free-${index}">${post.commentCount || 0}</span>
                      </button>
                    </div>
                    <div class="feed-card-comments-preview" style="margin-top:10px;">
                      ${commentPreviewHtml}
                      ${(post.commentCount||0)>2 ? `<button class="feed-more-comments-btn" onclick="window.showFullPost(${index},true)">ëŒ“ê¸€ ì „ì²´ë³´ê¸°</button>` : ''}
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      } catch (error) {
        console.error('ììœ  ì„¹ì…˜ ë¡œë”© ì˜¤ë¥˜:', error);
        container.innerHTML = '<div style="text-align:center;padding:40px;color:#f44336;">ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    };

    // ë”ë³´ê¸°/ëŒ“ê¸€ ì „ì²´ë³´ê¸° ì§„ì… í•¨ìˆ˜(ëª¨ë‹¬/ì „ì²´í™”ë©´ ë“± í™•ì¥ ê°€ëŠ¥)
    window.showFullPost = function(index, showComments=false) {
      // ì¶”í›„ ì „ì²´í™”ë©´/ëª¨ë‹¬ë¡œ í™•ì¥ ê°€ëŠ¥, í˜„ì¬ëŠ” ì „ì²´í™”ë©´ ì§„ì…
      window.openFreePage();
      setTimeout(()=>{
        if(showComments) {
          // ëŒ“ê¸€ ì…ë ¥ë€ í¬ì»¤ìŠ¤ ë“± ì¶”ê°€ ê°€ëŠ¥
        }
      }, 300);
    };

    // <script type="module"> ë‚´ë¶€ì—ì„œ ì•„ë˜ ìˆœì„œë¡œ ë°°ì¹˜
    // ... ê¸°ì¡´ ì½”ë“œ ...
    // 1. renderFreeFeed í•¨ìˆ˜ ì •ì˜
    window.renderFreeFeed = async function() {
      const container = document.getElementById('free-content');
      if (!container) return;
      let posts = await window.loadUserPosts();
      // ì •ë ¬
      if (window.freeFeedSort === 'popular') {
        posts = posts.slice().sort((a, b) => ((b.likes||0)+(b.commentCount||0)) - ((a.likes||0)+(a.commentCount||0)) || (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
      } else {
        posts = posts.slice().sort((a, b) => (b.timestamp?.seconds||0)-(a.timestamp?.seconds||0));
      }
      let html = `
        <div class="free-feed-tabs" style="display:flex;gap:8px;justify-content:flex-end;margin-bottom:18px;">
          <button id="free-tab-latest" class="feed-sort-btn${window.freeFeedSort==='latest'?' active':''}">ìµœì‹ ìˆœ</button>
          <button id="free-tab-popular" class="feed-sort-btn${window.freeFeedSort==='popular'?' active':''}">ì¸ê¸°ìˆœ</button>
        </div>
        <div class="free-feed-list">
      `;
      if (posts.length === 0) {
        html += `<div style="text-align:center;padding:40px;color:#666;">ì²« ë²ˆì§¸ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div>`;
      } else {
        html += posts.map((post, idx) => {
          const isMine = post.userId === window.getUserId();
          const preview = post.content.length > 60 ? post.content.slice(0, 60) + '...' : post.content;
          return `
            <div class="feed-card" style="margin-bottom:22px;box-shadow:0 2px 10px rgba(53,108,85,0.08);border-radius:18px;background:#fff;overflow:hidden;transition:box-shadow 0.2s;">
              <div class="feed-card-content" style="padding:20px;">
                <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                  <div class="feed-card-avatar" style="width:32px;height:32px;background:#e0ede3;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#356c55;">ìµ</div>
                  <div style="flex:1;">
                    <span style="font-weight:600;color:#356c55;">ìµëª…</span>
                    <span style="font-size:13px;color:#999;margin-left:8px;">${window.formatTime(post.timestamp)}</span>
                    ${isMine ? '<span style="background:#e0ede3;color:#356c55;font-size:12px;padding:2px 8px;border-radius:8px;margin-left:8px;">ë‚´ê°€ ì“´ ê¸€</span>' : ''}
                  </div>
                </div>
                <div class="feed-card-title" style="font-size:16px;font-weight:600;margin-bottom:6px;">${preview}</div>
                ${post.content.length > 60 ? `<button class="feed-more-btn" style="font-size:13px;color:#388e3c;background:none;border:none;cursor:pointer;" onclick="window.showFullPost(${idx})">ë”ë³´ê¸°</button>` : ''}
                <div class="feed-card-actions" style="display:flex;gap:16px;align-items:center;justify-content:flex-end;margin-top:12px;">
                  <button class="story-action-btn" style="color:#e74c3c;display:flex;align-items:center;gap:4px;background:none;border:none;cursor:pointer;font-size:15px;" onclick="window.toggleStoryLike('free', '${post.id}', ${idx})">
                    <span id="like-icon-free-${idx}">${post.isLiked?'â¤ï¸':'ğŸ¤'}</span>
                    <span id="like-count-free-${idx}">${post.likes || 0}</span>
                  </button>
                  <button class="story-action-btn comment-btn" style="color:#356c55;display:flex;align-items:center;gap:4px;background:none;border:none;cursor:pointer;font-size:15px;" onclick="window.showFullPost(${idx},true)">
                    <span>ğŸ’¬</span>
                    <span id="comment-count-free-${idx}">${post.commentCount || 0}</span>
                  </button>
                  ${isMine ? `<button class="story-action-btn" style="color:#888;font-size:13px;background:none;border:none;cursor:pointer;" onclick="window.editMyPost('${post.id}')">ìˆ˜ì •</button><button class="story-action-btn" style="color:#888;font-size:13px;background:none;border:none;cursor:pointer;" onclick="window.deleteMyPost('${post.id}')">ì‚­ì œ</button>` : ''}
                </div>
                <div class="feed-card-comments-preview" style="margin-top:10px;">
                  ${(Array.isArray(post.commentsPreview) && post.commentsPreview.length > 0) ? post.commentsPreview.slice(-2).map(c => `
                    <div class="feed-comment-preview" style="font-size:13px;color:#666;margin-bottom:2px;"><span class="feed-comment-author" style="color:#356c55;font-weight:600;">${c.author}</span>: <span class="feed-comment-text">${c.content.length>30?c.content.slice(0,30)+'...':c.content}</span></div>
                  `).join('') : ''}
                  ${(post.commentCount||0)>2 ? `<button class="feed-more-comments-btn" style="font-size:12px;color:#388e3c;background:none;border:none;cursor:pointer;" onclick="window.showFullPost(${idx},true)">ëŒ“ê¸€ ì „ì²´ë³´ê¸°</button>` : ''}
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
      html += '</div>';
      // í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼
      html += `<button class="floating-write-btn" id="floating-write-btn" title="ê¸€ì“°ê¸°">+</button>`;
      container.innerHTML = html;
      // íƒ­ ì´ë²¤íŠ¸
      document.getElementById('free-tab-latest').onclick = () => {
        window.freeFeedSort = 'latest';
        window.renderFreeFeed();
      };
      document.getElementById('free-tab-popular').onclick = () => {
        window.freeFeedSort = 'popular';
        window.renderFreeFeed();
      };
      // í”Œë¡œíŒ… ê¸€ì“°ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸(ì„ì‹œ: ìƒë‹¨ ê¸€ì“°ê¸° í¼ í¬ì»¤ìŠ¤)
      document.getElementById('floating-write-btn').onclick = () => {
        // ê¸€ì“°ê¸° í¼ì´ ì´ë¯¸ ìˆìœ¼ë©´ í¬ì»¤ìŠ¤, ì—†ìœ¼ë©´ ì‚½ì…
        let form = document.getElementById('habit-salon-free-form');
        if (!form) {
          // ë™ì ìœ¼ë¡œ ê¸€ì“°ê¸° í¼ ì‚½ì… (ìµœìƒë‹¨ì—)
          const feedList = document.querySelector('.free-feed-list');
          if (feedList) {
            const formDiv = document.createElement('div');
            formDiv.innerHTML = `
              <form id="habit-salon-free-form" style="margin-bottom:16px;">
                <textarea id="habit-salon-free-content" placeholder="ììœ ë¡­ê²Œ ê±´ê°• ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš” (50ì ì´ìƒ)" style="width:100%;height:80px;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:15px;resize:vertical;"></textarea>
                <button type="submit" style="margin-top:8px;width:100%;padding:12px;background:#356c55;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:700;">ììœ ê¸€ ì‘ì„± (+100P)</button>
              </form>
            `;
            feedList.prepend(formDiv);
            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            const newForm = document.getElementById('habit-salon-free-form');
            if (newForm) {
              newForm.addEventListener('submit', window.handleFreePostSubmit);
              newForm.querySelector('textarea').focus();
            }
          }
        } else {
          form.scrollIntoView({behavior:'smooth'});
          form.querySelector('textarea').focus();
        }
      };
    };

    // 2. openFreePage í•¨ìˆ˜ ì •ì˜ (renderFreeFeed ì´í›„ì— ìœ„ì¹˜)
    window.openFreePage = async function() {
      try {
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.add('active');
        await window.renderFreeFeed();
        setTimeout(() => {
          overlay.classList.remove('active');
          const fullscreenPage = document.getElementById('free-fullscreen');
          fullscreenPage.classList.add('active');
          document.body.style.overflow = 'hidden';
        }, 200);
      } catch (error) {
        console.error('ììœ ê¸€ ì „ì²´í™”ë©´ í˜ì´ì§€ ì—´ê¸° ì˜¤ë¥˜:', error);
        window.showSalonToast('í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
        const overlay = document.getElementById('page-transition-overlay');
        overlay.classList.remove('active');
      }
    };
    // ... existing code ...

    // 3. ê¸€ì“°ê¸° í˜ì´ì§€ ë‹«ê¸° í•¨ìˆ˜ ì¶”ê°€
    window.closeFreeWritePage = function() {
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      overlay.classList.add('active');
      writeFullscreen.classList.remove('active');
      setTimeout(() => {
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      }, 300);
    };

    // ê¸€ì“°ê¸° ê´€ë ¨ ì „ì—­ í•¨ìˆ˜ë“¤
    window.openWriteModal = function() {
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const textarea = document.getElementById('habit-salon-free-content');
      const submitBtn = document.getElementById('write-submit-btn');
      const overlay = document.getElementById('page-transition-overlay');
      
      if (!writeFullscreen || !textarea || !submitBtn || !overlay) {
        console.error('ê¸€ì“°ê¸° ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      overlay.classList.add('active');
      setTimeout(() => {
        overlay.classList.remove('active');
        writeFullscreen.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // textarea ì´ˆê¸°í™” ë° í¬ì»¤ìŠ¤
        textarea.value = '';
        textarea.focus();
        
        // ê¸€ììˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        updateCharCounter();
      }, 200);
      
      // textarea ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      textarea.oninput = function() {
        updateCharCounter();
        // 50ì ë¯¸ë§Œì´ë©´ ë²„íŠ¼ ë¹„í™œì„±í™”
        submitBtn.disabled = this.value.length < 50;
      };

      // ì œì¶œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      submitBtn.onclick = async function() {
        if (textarea.value.length < 50) {
          window.showSalonToast('ìµœì†Œ 50ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”.', 'warning');
          return;
        }

        try {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<span>ê³µìœ í•˜ëŠ” ì¤‘...</span>';
          
          // ê¸€ ì‘ì„± ì²˜ë¦¬
          await window.submitFreePost(textarea.value);
          
          // ëª¨ë‹¬ ë‹«ê¸°
          window.closeWriteModal();
          
          // í”¼ë“œ ìƒˆë¡œê³ ì¹¨
          await window.loadFreeSection();
          
          // ì™„ë£Œ í† ìŠ¤íŠ¸
          window.showSalonToast('ê±´ê°• ì´ì•¼ê¸°ê°€ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤! (+100P)', 'success');
          
          // ìŠ¤í¬ë¡¤ ìµœìƒë‹¨ìœ¼ë¡œ
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (error) {
          console.error('ê¸€ì“°ê¸° ì œì¶œ ì˜¤ë¥˜:', error);
          window.showSalonToast('ê¸€ì“°ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
          submitBtn.disabled = false;
          submitBtn.innerHTML = '<span>ê±´ê°• ì´ì•¼ê¸° ê³µìœ í•˜ê¸°</span><span>+100P</span>';
        }
      };
    };

    window.closeWriteModal = function() {
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      
      if (writeFullscreen && overlay) {
        overlay.classList.add('active');
        writeFullscreen.classList.remove('active');
        
        setTimeout(() => {
          overlay.classList.remove('active');
          document.body.style.overflow = 'auto';
        }, 300);
      }
    };

    // ê¸€ììˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateCharCounter() {
      const textarea = document.getElementById('habit-salon-free-content');
      const counter = document.querySelector('.char-counter');
      if (textarea && counter) {
        counter.textContent = `${textarea.value.length}/500`;
        // ê¸€ììˆ˜ì— ë”°ë¥¸ ì¹´ìš´í„° ìƒ‰ìƒ ë³€ê²½
        if (textarea.value.length < 50) {
          counter.style.color = '#f44336';
        } else {
          counter.style.color = '#666';
        }
      }
    }

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const writeFullscreen = document.getElementById('free-write-fullscreen');
        if (writeFullscreen && writeFullscreen.classList.contains('active')) {
          window.closeWriteModal();
        }
      }
    });

    // í”Œë¡œíŒ… ë²„íŠ¼ ì´ë²¤íŠ¸ë¥¼ ì „ì—­ ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ì²˜ë¦¬
    document.addEventListener('click', function(e) {
      const target = e.target.closest('#floating-write-btn');
      if (target) {
        e.preventDefault();
        window.openWriteModal();
      }
    });

    // ê¸€ì“°ê¸° ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
    window.openWriteModal = function() {
      console.log('ê¸€ì“°ê¸° ëª¨ë‹¬ ì—´ê¸° ì‹œë„');
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      
      if (!writeFullscreen || !overlay) {
        console.error('í•„ìš”í•œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { writeFullscreen, overlay });
        return;
      }
      
      console.log('ìš”ì†Œ ì°¾ìŒ, ëª¨ë‹¬ ì—´ê¸° ì‹œì‘');
      overlay.classList.add('active');
      setTimeout(() => {
        overlay.classList.remove('active');
        writeFullscreen.classList.add('active');
        document.body.style.overflow = 'hidden';
        const textarea = document.getElementById('habit-salon-free-content');
        if (textarea) {
          textarea.focus();
          console.log('í…ìŠ¤íŠ¸ì˜ì—­ í¬ì»¤ìŠ¤ ì™„ë£Œ');
        }
      }, 200);
    };

    window.closeWriteModal = function() {
      console.log('ê¸€ì“°ê¸° ëª¨ë‹¬ ë‹«ê¸° ì‹œë„');
      const writeFullscreen = document.getElementById('free-write-fullscreen');
      const overlay = document.getElementById('page-transition-overlay');
      
      if (!writeFullscreen || !overlay) {
        console.error('í•„ìš”í•œ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { writeFullscreen, overlay });
        return;
      }
      
      console.log('ìš”ì†Œ ì°¾ìŒ, ëª¨ë‹¬ ë‹«ê¸° ì‹œì‘');
      overlay.classList.add('active');
      writeFullscreen.classList.remove('active');
      setTimeout(() => {
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      }, 200);
    };

    // DOMì´ ë¡œë“œëœ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM ë¡œë“œë¨, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
      const floatingWriteBtn = document.getElementById('floating-write-btn');
      
      if (floatingWriteBtn) {
        console.log('í”Œë¡œíŒ… ë²„íŠ¼ ì°¾ìŒ, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€');
        floatingWriteBtn.onclick = window.openWriteModal;
      } else {
        console.error('í”Œë¡œíŒ… ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    });
  </script>
  </script>
  <script src="script.js" onerror="console.error('script.js ë¡œë“œ ì‹¤íŒ¨')" onload="console.log('script.js ë¡œë“œ ì„±ê³µ')"></script>
</body>
</html>
